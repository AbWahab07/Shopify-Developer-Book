<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
  <head>
    <title>A Developer's View of the Shopify Platform</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../templates/html/stylesheets/screen.css"/>
    <meta name="author" content="David Lazar, P.Eng" />
    <meta name="subject" content="Six Years of Working with Merchants and their Shops" />
    <meta name="keywords" content="Shopify, software development, API, Javascript, Ruby, cloud computing" />
    <meta name="date" content="2012-05-17" />
  </head>
  <body>
    <div class="frontcover container">
      <div>
        <h1>A Developer's View of the Shopify Platform</h1>
        <p class="description">Six Years of Working with Merchants and their Shops</p>
        <p class="authors">By David Lazar, P.Eng</p>
      </div>
    </div>

    <div class="table-of-contents">
      <h2 class="no-toc">Table of Contents</h2>
      <div id="toc">
        <div class="level3 forward"><a href="#forward"><span>Forward</span></a></div><div class="level3 preface"><a href="#preface"><span>Preface</span></a></div><div class="level3 acknowledgements"><a href="#acknowledgements"><span>Acknowledgements</span></a></div><div class="level3 who-is-this-ebook-for"><a href="#who-is-this-ebook-for"><span>Who is this eBook For?</span></a></div><div class="level3 what-is-assumed-by-the-author"><a href="#what-is-assumed-by-the-author"><span>What is Assumed by the Author</span></a></div><div class="level3 about-the-author"><a href="#about-the-author"><span>About the Author</span></a></div><div class="level3 finding-shopify-what-a-relief"><a href="#finding-shopify-what-a-relief"><span>Finding Shopify, What a Relief!</span></a></div><div class="level2 the-shopify-platform"><a href="#the-shopify-platform"><span>The Shopify Platform</span></a></div><div class="level3 shop-administration"><a href="#shop-administration"><span>Shop Administration</span></a></div><div class="level3 liquid-templating"><a href="#liquid-templating"><span>Liquid Templating</span></a></div><div class="level3 javascript-api"><a href="#javascript-api"><span>Javascript API</span></a></div><div class="level3 shopify-api"><a href="#shopify-api"><span>Shopify API</span></a></div><div class="level3 theme-store"><a href="#theme-store"><span>Theme Store</span></a></div><div class="level3 app-store"><a href="#app-store"><span>App Store</span></a></div><div class="level3 shopify-experts"><a href="#shopify-experts"><span>Shopify Experts</span></a></div><div class="level2 shopify-developer-tools"><a href="#shopify-developer-tools"><span>Shopify Developer Tools</span></a></div><div class="level3 the-text-editor"><a href="#the-text-editor"><span>The Text Editor</span></a></div><div class="level3 the-web-browser"><a href="#the-web-browser"><span>The Web Browser</span></a></div><div class="level3 versioning-your-work"><a href="#versioning-your-work"><span>Versioning Your Work</span></a></div><div class="level3 dropbox"><a href="#dropbox"><span>Dropbox</span></a></div><div class="level3 skitch"><a href="#skitch"><span>Skitch</span></a></div><div class="level3 instant-messaging"><a href="#instant-messaging"><span>Instant Messaging</span></a></div><div class="level3 terminal-mode-or-command-line-thinking"><a href="#terminal-mode-or-command-line-thinking"><span>Terminal Mode or Command-Line Thinking</span></a></div><div class="level3 localhost-development-on-a-laptop-desktop-or-other-devices"><a href="#localhost-development-on-a-laptop-desktop-or-other-devices"><span>Localhost Development on a Laptop, Desktop or Other Devices</span></a></div><div class="level3 pre-compiled-css"><a href="#pre-compiled-css"><span>Pre-Compiled CSS</span></a></div><div class="level2 common-questions"><a href="#common-questions"><span>Common Questions</span></a></div><div class="level3 how-to-capture-that-extra-information"><a href="#how-to-capture-that-extra-information"><span>How to Capture that Extra Information</span></a></div><div class="level3 image-switching"><a href="#image-switching"><span>Image Switching</span></a></div><div class="level3 cross-domain-support-with-jsonp-cors-or-iframe-elements"><a href="#cross-domain-support-with-jsonp-cors-or-iframe-elements"><span>Cross-Domain Support with JSONP, CORS or iframe Elements</span></a></div><div class="level3 special-invites"><a href="#special-invites"><span>Special Invites</span></a></div><div class="level2 and-youre-wondering-about-clients"><a href="#and-youre-wondering-about-clients"><span>And Youâ€™re Wondering About Clients?</span></a></div><div class="level3 merchants-respond-to-clear-explanations"><a href="#merchants-respond-to-clear-explanations"><span>Merchants Respond to Clear Explanations</span></a></div><div class="level3 merchants-want-variable-pricing"><a href="#merchants-want-variable-pricing"><span>Merchants Want Variable Pricing</span></a></div><div class="level2 shop-customizations"><a href="#shop-customizations"><span>Shop Customizations</span></a></div><div class="level3 using-delayed-jobs-to-manage-api-limits"><a href="#using-delayed-jobs-to-manage-api-limits"><span>Using Delayed Jobs to Manage API Limits</span></a></div><div class="level3 using-cart-attributes-and-webhooks-together"><a href="#using-cart-attributes-and-webhooks-together"><span>Using Cart Attributes and WebHooks Together</span></a></div><div class="level3 adding-upsells-to-boost-sales"><a href="#adding-upsells-to-boost-sales"><span>Adding Upsells to Boost Sales</span></a></div><div class="level3 adding-sms-notifications"><a href="#adding-sms-notifications"><span>Adding SMS Notifications</span></a></div><div class="level2 shopify-inventory"><a href="#shopify-inventory"><span>Shopify Inventory</span></a></div><div class="level3 summary-of-developing-code-with-products"><a href="#summary-of-developing-code-with-products"><span>Summary of Developing Code with Products</span></a></div><div class="level2 the-shopify-api"><a href="#the-shopify-api"><span>The Shopify API</span></a></div><div class="level2 how-to-handle-webhook-requests"><a href="#how-to-handle-webhook-requests"><span>How to Handle Webhook Requests</span></a></div><div class="level3 the-interesting-world-of-webhooks"><a href="#the-interesting-world-of-webhooks"><span>The Interesting World of WebHooks</span></a></div><div class="level3 webhook-validation"><a href="#webhook-validation"><span>WebHook Validation</span></a></div><div class="level3 looking-out-for-duplicate-webhooks"><a href="#looking-out-for-duplicate-webhooks"><span>Looking out for Duplicate Webhooks</span></a></div><div class="level3 parsing-webhooks"><a href="#parsing-webhooks"><span>Parsing WebHooks</span></a></div><div class="level3 cart-customization"><a href="#cart-customization"><span>Cart Customization</span></a></div><div class="level2 command-line-shopify"><a href="#command-line-shopify"><span>Command Line Shopify</span></a></div><div class="level3 the-shopify-command-line-console"><a href="#the-shopify-command-line-console"><span>The shopify Command Line Console</span></a></div><div class="level3 the-shopify-theme-command-line-console"><a href="#the-shopify-theme-command-line-console"><span>The Shopify Theme Command Line Console</span></a></div>
      </div>
    </div>

    <div id="chapters">
      
    <div class="chapter"><h3 id="forward">Forward</h3>

<p>Being a software developer for the Shopify platform is a great way to work with computing skills currently in demand and to pay the bills. E-Commerce is seeing explosive growth and there are constantly new markets evolving. Working on Shopify merchant sites and App projects and your email inbox fills with letters like this: &#x201C;Just thought you&#x2019;d like to know Shopify sent you $148.00 USD&#x201D; or &#x201C;FizzBuzz.com just sent you $2622.50 USD with PayPal&#x201D;. That should inspire the effort to learn the API and programming patterns for e-commerce! It is a great way to earn <em>passive</em> income that you can combine with working for merchants to make <em>active</em> income. It&#x2019;s a career and can be the basis for a successful business, and offers up a wide range of interesting opportunities. Specializing on theme development is rewarding financially for those with design flair and skills. App development and making custom scripts for merchant shops is my favorite. It offers the challenges of using cloud computing, networking, database development, connecting to API driven services like social media and many others. It is great when code you&#x2019;ve written helps a merchant increase their sales 20% overnight! I sincerely hope that developers considering work on Shopify projects read this and get inspired to work on making the next great merchant shop or App. I have worked with and for hundreds of happy merchants and they continue to tell me how happy they are with the Shopify platform.</p>

<h3 id="preface">Preface</h3>

<p>I like to think that I don&#x2019;t really mark time with much enthusiasm or rigour. When I began my professional career developing code to non-destructively test steel bridges for structural integrity, I marked off eight years before I sensed I had done enough crazy climbing and driving and that I needed a break. I spent a good five years around the dotcom bubble renting a nice office with good friends trying to make web apps. Then I spent five more years taking on a variety of consulting gigs that in the end never amounted to a hill of beans but taught me how to wear many various business hats. I picked up the Shopify bug and tried working with a boutique web agency. As five more years passed, I realized that I knew a lot about being an independent computer business, and that I knew a lot about tricking out Shopify for an ever growing list of clients. I have yet to give myself an official work title, nor have I declared my intentions or loyalty to any one type of computing and my Corporation is pretty much a sad sack but expensive accounting exercise I leave to those who get a kick out that kind of thing. I am sure it&#x2019;s going to reach a decade in age as neglected as my vinyl collection. One needs a corporation though to run off invoices and interact with clients in foreign nations, so I go along with that. Dividends anyone?</p>

<p>A beautiful autumn day in Montreal and Shopify came for a visit with their CTO Cody, Joey Devilla on the Accordion and Edward the king of the API, with much swag and the company credit cards to cover the beer bill. We owe that to Meeech who organized it all and attracted a small but curious crowd of locals to hear more about Shopify. I decided at that time to pitch this effort, an eBook written from the perspective of a developer with a lot of experience working on Shopify, but not working for Shopify. Over the years my nom de plume of Hunkybill on the Shopify public forums wrote many words on many subjects and I endured the gamut possible responses over time. My all time favorite is still <em>Plonk</em> as that one word continues to tickle my funny bone. If a couple of thousand Hunkybill posts survive on some hard drive in some data center for a few more years that is one thing, but I was pretty sure I wanted to create something a little more structered and formal.</p>

<h3 id="acknowledgements">Acknowledgements</h3>

<p>First an foremost I want to say a big thank you to Shopify for supporting this effort through the Shopify fund. Over the years I expended energy and time recommending Shopify to all comers but at the same time, I can see that I was also critical and not always a perfect gentleman in my writing. Instead of ignoring me and my pitch however, Shopify chose to sweep aside some of the lower points from the past. Taking the high road and for that I am grateful.</p>

<p>To all the developers and designers that I have interacted with I owe a hearty thanks to as well. Some fine people have come and gone from the Shopify community over the years and I do respect the fact that a lot of their contributions remain useful and just as valid today as they were five years ago. It is very inspiring to have witnessed how one Caroline Schnapp jumped into the Shopify community, starting off with some simple scripting work to make shops better until ultimately she was so valuable to Shopify they hired her! My thanks to Caroline for sharing with me her wisdom about how Shopify really works and for always correcting me when my forum posts are clearly sour or plain wrong. I mean no harm to anyone and I am trying hard to avoid controversy these days.</p>

<p>I also with to thank Tobi from Shopify for his numerous great contributions to open source software like Liquid and Delayed Job. Programmers always learn by studying what other successful programmers have done and I must admit that I have learned many good things from his code. Thanks to Jesse Storimer for sharing his eBook tools with me and his code. His original Shopify API Sinatra application was the inspiration that moved me to develop an App for myself and today I have over 500 installed Apps all based of off Sinatra running well in the cloud thanks to Heroku! The best developer friendly cloud platform has to be Heroku. Thanks also to Cody, Edward, Joey and Harley for the hospitality when I trucked on down the 417 to Ottawa for a visit to the new office. Very swell place to work and I am sure the entire gang that works there have one of the better workplaces in all of Canada to go to on a daily basis.</p>

<p>Thanks to my wife and kids for putting up with a guy who likes to sit in the corner all day and poke away at a keyboard instead of doing something heroic like flying space shuttles or putting out forest fires or saving baby seals from being clubbed. I try to be exciting for you but I just can&#x2019;t seem to find the right chords.</p>

<h3 id="who-is-this-ebook-for">Who is this eBook For?</h3>

<p>Everyone that is interested in Shopify&#x2026;</p>

<p>Why?</p>

<p>If you know nothing about Shopify, this book will provide some information about how it all works. Perhaps enough to inspire someone to go the next step and do some real research.</p>

<p>If you know a little something about Shopify, this book will probably teach you at least one thing you probably did not know.</p>

<p>If you want to develop apps for Shopify, or build a theme for someone, this book may shed some light on the particulars of doing that.</p>

<h3 id="what-is-assumed-by-the-author">What is Assumed by the Author</h3>

<p>Nothing. Assumptions are almost always wrong. This is no written attempt to coddle anyone on the path to mastering some specific aspect of Shopify. This book is <em>not</em> a &#x201C;Learn Shopify in 7 minutes, 7 hours, or 7 days&#x201D; recipe book. There is no attempt to put into words any of the magic spells, incantations or dangerous chemistry that goes into the workaday world of a professional Shopify coder.</p>

<h3 id="about-the-author">About the Author</h3>

<p>My engineering career started professionally in 1990 at about the same the World Wide Web was invented with the introduction of HTTP protocol for the Internet. Before the use of HTTP was common the Internet was mainly used to exchange email (using SMTP), to post messages and have discussions on Usenet (using NNTP) or transferring binary and text files between clients and servers (using FTP). Archie, Veronica and Gopher were other interesting choices to use for searching documents. Once the Internet concept jumped across the early adopter chasm to be embraced by the dotcom businesses and general population, a flurry of changes ensued. Nortel had ramped up to make the Internet as fast and capable as is it today (and ironically crashed in the resulting process) and throngs of business people sitting on the sidelines with few clues about what to do with this vast network poured money into the foundations of what are today some of the most valuable business properties in the world.</p>

<p>1998 was the year I transitioned my software development focus from R&amp;D C and C++ development to Internet Computing. I recognized that one could craft very efficient programs with much less code using dynamic scripting languages, like Ruby, Python and PHP. If it took 25 lines of Java or C++ to put a button on the screen, Ruby or Tcl/Tk did it in one line. I was hooked on that concept.</p>

<p>The early commercial Internet was all about established software titans showing off their chops. Coding for the web involved Microsoft ASP, Visual Studio and SQL Server to deliver web applications running on hugely energy inefficient Compaq Proliant servers. Other quirky technologies like Cold Fusion were often used too. Many friends and collegues have done what I have and hung out a shingle as an Internet computing engineer. Need a web enabled CRM? I can write you one. Need to manage your freight forwarding logistics company on the web? I can make you a web app for that. Need a website to sell flowers online? I can make you one. Need to send 50,000 emails to your world-wide employees? Got that covered. You have to interface to an EDI system with an AS/400 legacy database and a transactional web site? Let&#x2019;s do it. Ariba XML catalog to a SMB web site with an XML catalog of business pens and office equipment? Sure why not.</p>

<p>In the early years of running your own business as a software engineering consultant or freelance programmer you, like me, will inevitably experience the pain of working capital shortages. You&#x2019;ll collect a cadre of loyal clients with small or tiny budgets. You cannot easily sell them anything from Microsoft, Oracle or most other enterprise technology companies. Try presenting a license acquisition cost of $22,000 for a database server for your SMB client. The world of proprietary and expensive software pushed me to drop all that and adopt Open Source Software as my toolkit. I started developing using Linux as my operating system, PHP as my server-side scripting language, and PostgreSQL as my database.</p>

<p>Ignoring Perl as a web app scripting language and adopting the new kid on the block PHP meant building out a CMS was best done with Drupal and E-Commerce for the masses with OSCommerce. There was very little Ruby or Python code for these endeavors so I hunkered down to try and fill my toolbox with the best tools that did not totally suck. Yahoo came out with their brilliant YUI framework and I jumped on that immediately for the nice documentation and functionalities it provided. Soon after a software developer named Jack Slocum came along and decided to extend YUI into his own vision of a framework. He called his version YUI-ext and quickly attracted a small but loyal following. His vision was to provide Grids (like excel), and Trees (like Windows explorer or Mac OS Finder), and dialog boxes, and toolbars and most of the widgets that we take for granted today but that were rare indeed back then. Eventually that code matured into it&#x2019;s own product called ExtJS that today is perhaps better known as Sencha. Shopify was born at about this period of time in my timeline. Just as Ruby on Rails was becoming the new kid on the block.</p>

<p>PHP and Javascript were constantly evolving as were web browsers. As Microsoft oddly chose to stagnate with their now infamously bad IE web browser, Mozilla, Safari and Opera continued to extend web browser capabilities enough so that we could see realized the vision of web applications with enough sophistication to justify comparing them to native applications. Tools like Firebug and the Firefox browser, combined with Ajax (ironically a huge thanks to Microsoft for asynchronous Javascript) and the Ruby language offering introspection into a running Web App, developers now had something really hot to work with.</p>

<h3 id="finding-shopify-what-a-relief">Finding Shopify, What a Relief!</h3>

<p>Shopify was being developed and released as a Beta service. I signed up as soon as the Beta was available, knowing I would be able to offer e-commerce to my clients, without having to hack PHP OSCommerce again. If you have never examined OSCommerce code, you are somewhat lucky. It was at best a spaghetti western in terms of code. Plus Shopify offered a hosted service, eliminating worries about security, backups and system administration tasks. Having to maintain my own Linux and Windows servers in a co-location facility over many years provided me with ample opportunities to freak out with the responsibilities of system administration tasks. How to SSH tunnel between boxes? How to best freak out when hard drives failed? How can RAID can be a source of mirror images of garbage? How come hackers keep trying for years to break into my puny systems? How lousy is it to have to patch/upgrade services like Apache, PHP, Postfix, etc? Answer! Very much a lousy thing, at least for me. There is nothing like finding out a client&#x2019;s SSL certificate has expired, and I cannot exchange it for a new one without the password for the old one that is long forgotten and lost due to neglect. There is nothing quite like finding out the database has been failing to record certain entries for a few weeks due to a memory corruption bug.</p>

<p>Shopify to the rescue! Hosted E-Commerce! No more headaches! Simple templating with Liquid, ability to do any Javascript I want! That is the pattern that works for me. Should work for almost anyone.</p>

</div>
    <div class="chapter"><h2 id="the-shopify-platform">The Shopify Platform</h2>

<p>Since it&#x2019;s release to the public as a hosted e-commerce platform, Shopify has evolved through the adoption of new functionalities, the introduction of new features, as well as the refinement of the interface presented to Shop owners. As much as we all know competition drives companies to improve their products and services, in the niche domain of hosted e-commerce there are enough platforms to choose from that the decision to use one does require some careful study, thought and analysis. My experience over the years as a Shopify developer has informed me on how best to use the platform and when not to shut the door on possibilities.</p>

<p>For the sake of simplicity and consistency there are some definitions that will help in understanding the perspective of this book. The most important definition is the one for Shopify App. Shopify has an API and it allows external computer programs to interact with a shop according to certain rules. If an attempt is made to communicate via the API to a shop, and that request is authenticated it will go through and probably return some data as XML or JSON. Maybe that request will return HTML in a separate website. As long as the request is formatted correctly and has the right authentication token it will work. A Shopify App is an externally hosted website that has been setup to connect to a Shop. Shopify merchants can plugin external Apps to their shops to provide additional functionality. A Shopify App is like an Android or iPhone App but it is usually found in the Shopify App store. The process of installing an App for a merchant usually involves approving the App for installation and sometimes approving a charge to use the App too. Some Apps are free, others have a monthly recurring fee and some offer a one-time fee as well. The sign-up and installation for Shopify Apps is very much like any other App installation procedure. It is entirely possible for a merchant to develop or pay to have developed an App that will only ever be installed and used in his or her shop. There is no real limit to the number of uses for Apps as far as Shopify is concerned. This is a very powerful argument for why Shopify is a leader in hosted e-commerce as the API and platform are very well done for this kind of computing. Apps can be hosted in the cloud, on a personal server and even run off of laptops in a coffee shop. They consume resources but they are entirely outside the scope of Shopify&#x2019;s data center and Shopify&#x2019;s technical support.</p>

<p>The diagram presented here shows the relationships three specific types of people will have with Shopify, namely the customer, the merchant and the Shopify App developer.</p>
<div class="figure">
<img alt="The Shopify Platform and Users" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/platform.png" /></div>
<p>A customer will typically only interact with a shop. A shop may in fact interact with Shopify using the Javascript API to do Ajax. Both the merchant and the App developer also interact with the shop to ensure it is rendering properly. The merchant runs the shop and deals with orders. Merchants may also login to their Apps to control things like fulfillments, inventory management, communications with customers, status updates of orders and any number of other things. App developers will also likely be logging in to the App to ensure operations are optimal. It is possible for both the merchant and the app developer as well as the customer to utilize an App that presents a public facing web presence. For example, the customers could login at <em>someapp.fizzbuzz.com</em> to check on their order status. The merchant might very well login at <em>someapp.fizzbuzz.com/admin/</em> to deal with setting up special aspects of their orders. Finally, all shop WebHooks and perhaps some internal link added to the shop by the App would be accessed at <em>someapp.fizzbuzz.com/shopify/</em> through the Shopify authentication mechanism.</p>

<h3 id="shop-administration">Shop Administration</h3>

<p>One of the most important aspects of setting up and managing a shop for online sales has to be the web based user interface for controlling products, orders, themes, navigation, collections and all the many aspects that make up a Shopify shop. Originallly Shopify provided some very basic templates to build a shop and the support functions for setting up an inventory of products and collections. The limited amount of functionality made it possible to open up a shop quickly that looked good. As the number of merchants expanded from hundreds to tens of thousands the administrative interface became the focus of much attention. Every button or link click is under constant scrutiny with lots of public discussion on how changes affected merchants. The administration interface functions as an example of a well thought out design that relies on incremental change as opposed to radical make-overs. Considering the backlash a lot of web applications generate by changing their look and feel Shopify has done a great job of delivering improvements while maintaining consistentecy. Merchants have to invest in learning Shopify and so it would seem problematic to be constantly changing the way they interact with their shop. The early version of product tags was a text based interface. Adding or removing tags was not intuitive or awkward but it was not clear how tags worked to improve a shop for customers. Providing some examples and guidance on tags and using them with collections to filter products, they became a much more useful part of administration. Tags are now managed with a nicer interface of clickable pills. New merchants to Shopify do not have the luxury of seeing how Shopify has evolved but that does not mean the history is not evident to merchants with longer term accounts.</p>

<h3 id="liquid-templating">Liquid Templating</h3>

<p>Web application developers have adapted numerous patterns and techniques for delivering the HTML that makes up the <em>look</em> and <em>feel</em> of a web application. The first popular web application platforms usually rendered information through a combination of what is commonly referred to as spaghetti code. The mixing of scripting code with output code. PHP was and still is one of the best sources to find examples of this pattern where you can be sure developers will be mixing authentication code, SQL database code, form code and other HTML elements directly in the same file. The obvious problem with this mess is that it keeps programmers, designers and integrators all working on the same code. This usually resulted in only programmers being able to perform all those functions. A great innovation was to separate the two camps, keeping programming the responsibility of only the programmer, and letting designers look after the views. The introduction of templating for web applications meant a template could render the look when the applications scripting provided the data. That is a pretty good pattern for systems where the end user is also the owner of the data and most Wordpress sites function this way.</p>

<p>With a hosted platform like Shopify there is simply no chance that a merchant can directly script their shop due to the high probability that a merchant would destroy valuable data with a single erroneous command. Instead Shopify provides merchants with secure and non-destructive access to all the shop&#x2019;s data, while providing sophistication in terms of rendering that data nicely. The templating project was created by Tobias Luttke and is called <a href="https://github.com/Shopify/liquid">Liquid</a>. It&#x2019;s an open-source templating language that is the real star of the Shopify platform for merchants and theme designers. Liquid provides access to shop data without requiring merchants to have secret database passwords or requiring them to create and run complex SQL database queries. Liquid provides common programming idioms like <em>looping</em> over sets of data, making <em>conditional branches</em> to do one thing or another, and also has been setup by Shopify to provide a large set of very useful <em>filters</em> that can be applied to data.</p>

<p>The Liquid processing phase is crucial to solid merchant understanding of Shopify. A request from a customer on the Internet for a shop at <em>someshop.myshopify.com</em> arrives. Shopify locates the shop and loads up the <em>theme.liquid</em> file for the shop. By processing the <em>theme.liquid</em> code line by line, a series of assets get pulled into the theme. Examples would be the cascading style sheets (CSS) and Javascript needed by the shop. Each <em>theme.liquid</em> file has to specify where to render or draw the content of the current request which could be the homepage, a product, a blog, a collection or even the cart. Shopify determines the correct liquid file to pull in and adds it to the whole page once it has been processed. A theme file like <em>product.liquid</em> can specify snippets of Liquid code to include in the processing chain. Sometimes it is beneficial to take special aspects of a shop like a homepage carousel showing off products and keeping all that code together in a snippet. Snippets can be re-used on other parts of the site by simply including the snippet in the liquid files that need them. Once all of the code is assembled, processed and added together, the Liquid is quickly converted into HTML and that gets output as a complete web page for the customer.</p>

<p>The implication for merchants and developers to note is that they cannot inject code into Liquid. You cannot use Javascript to alter Liquid. It must be understood that Liquid is going to completely process all the shop data and provide the HTML Document Object Model (DOM) that is rendering in a web browser. Shopify provides an opportunity to take advantage of this Liquid rendering stage to make theme rendering somewhat programmable. Any settings that a theme provides as Liquid get processed too. One example of where this comes in handy is in the style sheets for a site. You can name a CSS file <em>uncle-bob.css.liquid</em> and this file will be processed with any Liquid being turned into actual CSS directives. A merchant that wants to make their text <em>bold</em> and <em>red</em> instead of <em>italic</em> and <em>blue</em> could make the changes using the shops theme settings link where these options are presented. There is a huge amount of creativity available with this system and it keeps merchants and developers on track since they cannot break their shop. Totally illegal and bad Liquid will usually generate an error and not be saved or used. Shopify is also all about speed and is one of the <em>fastest</em> hosted platforms available thanks in large part to Liquid that has been compiled into HTML and aggressively cached. If five, ten or even hundreds of people all request the same shop at the same time, they will all get the same copy of the HTML in their browser quickly. Shopify will not be compiling the Liquid five, ten or hundreds times, but instead will deliver the shop from fast cache nearest the customer. This is why it is important for merchants and developers to write efficient Liquid when possible. It is very easy to setup loops within loops within loops to provide a clever shopping experience, but when analysed with an algorithmic eye, these kinds of Liquid constructs are inefficient but they do work. Shopify will not usually interfere with how people use Liquid.</p>
<div class="figure">
<img alt="Possible Distributions of Shops and Their Uses of the Shopify Platform" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/TypesOfShops2.png" /></div>
<h3 id="javascript-api">Javascript API</h3>

<p>Javascript is usually used inside web browsers on HTML documents. Web applications use HTTP GET and POST to process requests and generate responses for those browsers. Every submit button or link click can result in a whole new web page being sent to the browser. Microsoft developed Asynchronous HTTP that came to be widely known as Ajax (or XHR). Ajax allowed a web site to send a request to a server and then listen for the reply which could come later using a callback function. This radically changed the entire web since it meant a website could replace a small part of itself with new information and not the entire page. Shopify fully embraces this with the Javascript API. Any shop can use Javascript to send Ajax requests. An example would be to load a cart with 16 products each with a unique quantity. Once that completes, another request could then request the contents of the cart to get the total price of all the items in the cart. Javascript can set a cart note from the homepage. It can delete a product in the cart from the product page. There is a whole world of very useful scripting that can be done with basic Javascript and the Javascript API. The Javascript API truly is a crucial and wonderful aspect of developing shops on the Shopify platform.</p>

<p>There are some interesting Javascript files apart from the Shopify Javascript API that are available to help make shops more sophisticated in the presentation of products. The most common is probably the <em>option selector</em> code available for shops that want to present products with various options like colour, size or material. The natural HTML element to use when presenting options is the <em>select</em> element. The use of options can increase the number of variants dramatically. A product that has three colours, four sizes and six different materials generates seventy-two variants! Shopify allows up to one hundred variants per product. The Javascript option selector code presents each option in it&#x2019;s own select element making it pretty easy for a customer to select from the available colours, sizes and materials to quickly find the variant they want to purchase. It also allows a merchant to present when variants are sold out or even to completely hide unavailable products. Shopify offers a small Javascript file that will hide any options that are sold out allowing a shop to present only variants that are actually in stock. This is a very handy extension to the usual option selector code.</p>

<p>There is also free Javascript that can present estimated shipping costs in the cart where they can be seen before checkout. The customer sees a form that collects the general location for delivery via a zip or postal code, and then uses the Shopify API to query the shipping services setup for the shop. For shops that offer expensive small items eg: jewelery, or ones that offer relatively cheap large items eg: stuffed animals, shipping can be a real problem to accommodate well. Freight is calculated on dimensional packaging and not necessarily weight. The Shopify shipping estimator can really help customers see a close approximation of the true price of a purchase before any shocks occur at checkout and that can really help converting carts into sales.</p>

<p>Shopify also provides some Javascript called <em>Customizr</em>. If a merchant has to record a name for engraving on a glass baby bottle, or collect the initials to be monogrammed on a leather handbag, or any other number of customization tasks, it is almost certain that collecting this information will be done using <em>cart attributes</em>. Cart attributes are passed right through checkout with the order and are available in the <em>Order Notes</em> section of the order details. Cart attributes can be rendered in the order confirmation email to inform the customer of their purchase details. Further excellent opportunities exist to help a shop since orders can be sent to a custom App using WebHooks. A custom App can perform additional business logic based on the cart note and cart attributes as well. This is described in more detail when talking of App development itself elsewhere in this guide. Using cart attributes to collect information is <em>complex</em>. This is because a merchant has to collect data at the product presentation level while recognizing previous customization efforts. When switching to the cart view of things shoppers will often want more than one of something, and the customization code has to manage quantity too. When shoppers remove an item from their cart, any corresponding cart attributes have to be dealt with. Checkout is separate from the shop and if a shopper starts checkout but then decides to revisit the shop, all the customization has to be available. Hence any code to handle customization has to be rock solid and demonstrate a mastery of browser features like localStorage, cookies, and the ability to serialize data as JSON. Ultimately a merchant has to be able to know a glass baby bottle gets etched with the name &#x201C;Eddy&#x201D; and a handbag gets the initials &#x201C;G.B.H&#x201D; or &#x201C;S.N.F.U&#x201D;. Customizr can go a long way to making this possible without a major investment in custom Javascript code since Shopify provides it.</p>

<h3 id="shopify-api">Shopify API</h3>

<p>For merchants and developers the <a href="http://api.shopify.com/">Shopify API</a> is the most important and best feature of Shopify as an e-commerce platform. For those that like convenience (and really who doesn&#x2019;t) the various available API wrappers offer excellent opportunities to work with shops and their data. The <a href="https://github.com/Shopify/shopify_api">Ruby version</a> provides a command line interface (CLI) that is described elsewhere in this book that can be used to query a shop using the API with just a few lines of code. It is possible to alter every product in a shop by changing the product&#x2019;s <em>type</em> or <em>vendor</em>. This beats downloading the inventory as CSV and editing those values followed by importing that CSV and waiting many minutes.</p>

<p>Developers should join the <a href="https://app.shopify.com/services/partners">Shopify Partner</a> program to begin working with Shopify merchants on both their shops and on Apps. The partner application allows developers to create Test Shops and Apps. To get started when creating an App it needs a name and once created it generates an API token and a shared secret and can thus be installed in a shop. An App can issue HTTP requests using XML or JSON formatted data. An App that formulates requests as per the Shopify API can thus be used to provide additional functionality to a shop. Apps can be created to add features to just one shop as a private exercise, or they can be created to be installed in thousands of shops, offering their provided functionality to all those shops. Hosting an App in the cloud makes it easy to ensure that the App has the resources to handle hundreds or thousands of installations. Some developers prefer to run their own servers and that works equally well. To test Apps out they can even be on a laptop located in a coffee shop.</p>

<p>The API itself is well described by Shopify but it may still be opaque to merchants and developers exactly what this API can be used for. One example that justifies the use of a custom App and the API is a shop that sells works of art, an online art gallery. Art is a unique domain with some specific quirks that make it interesting and perhaps non-traditional for e-commerce. A work of art, say a painting is for sale as a product. Paintings can be organized into collections just as they might be in a gallery or museum. For example paintings for sale might be grouped as abstract or contemporary or mixed media or as a print. The challenge for a gallery is to present all the unique attributes of a piece of art. A painting belongs to an Artist who almost certainly has a biography. A painting has a history in that it has likely been toured around other galleries and museums. Each such exhibition adds some value to the story of the painting and has to be told. The history, artist information and other metadata is best captured as resources attached to the painting, not as something you just stuff inside the paintings description. Using the API it is easy to capture this metadata and create resources that can be attached to each product. Thus a shop can manage products for sale so that they render their own history without it being tightly coupled to the product description. Using an App and the API it is possible to capture all the unique details supporting a product as resources and to present those resources when needed.</p>

<p>To make a gallery style shop easier to manage these extra resources have to be available to the merchant and designer so they can be presented in the shop&#x2019;s theme as Liquid. An App has an option to add an <em>App Proxy</em> that serves as a <em>special page</em> in a shop. A gallery shop can navigate clients to the special page and render all the custom resources. An example for the concept of an Artist is when showing the special page there is a Liquid template that contains custom Liquid tags.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"artist"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"artist-name"</span><span class="nt">&gt;</span>{{ artist.name }}<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ artist.country }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ artist.biography }}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
</div>
<p>When a customer visits this page there is a brief request made to the App Proxy providing the app with the artist&#x2019;s identification like their name. The app looks for a Liquid template it installed in the shop, and it reads that template since it could&#x2019;ve been altered by the merchant or theme designer. The app Proxy then searches the App for the artist&#x2019;s information based on the provided name and once found, it replaces the liquid tags with the appropriate information. The App then sends back the Liquid template for processing by Shopify. Customers will see the artist&#x2019;s information like their name, country and biography, along with a collection of the artist&#x2019;s paintings, all rendered from a standard Shopify collection. There are endless possibilities and combinations that can be created with apps and the App Proxy.</p>

<p>The combination of the Shopify API, externally hosted Apps and their App Proxies provide merchants and developers with an amazing degree of latitude to make shops that go far beyond the basics of selling snowboards or t-shirts. Constant development and improvement to these platform features ensure we&#x2019;ll be seeing incredibly slick and interesting shops in the future.</p>

<h3 id="theme-store">Theme Store</h3>

<p>When Shopify went public there were just a handful of themes available. Merchants could download these themes as zip files and tinker with the HTML, Javascript, CSS and Liquid constructs using a text editor. There were three ways to see the effect of editing a theme. One was to edit the theme on your computer, zip compress the edited files and upload them to the shop. A second way was to edit the theme directly inside the shop administration screens. This was not a great option at that time since Javascript editors were primitive and error prone. The third was provided by a web application called Vision that you installed on your computer. Vision provided a small inventory of snowboards for sale and the shop templates showing off the theme changes the merchant made. This approach was panned and ultimately abandoned as it failed to keep up with Shopify itself. A lot of merchants had trouble with theme changes that always showed snowboards for sale. The Vision inventory of products and pages and collections could be hacked since it was just a text based YAML file, but this was also tedious and prone to error. Most merchants were happy when Shopify abandoned Vision and decided to provide test shops to work off of instead. As mentioned when you become a Shopify Partner you can create as many test shops as you need and you can assign as many themes as you want to them. You can also load an real inventory into a test shop so this provides a great way to develop a theme without the risk of borking a live production shop making sales. At the same time as the Partner program was initiated Shopify presented a <a href="http://themes.shopify.com/">Theme store</a> where merchants can download free or paid themes. Themes that cost money usually come with features that might otherwise cost merchants money to develop themselves.</p>

<p>For talented web designers that understand the nuances of cross-browser issues with respect to Javascript and Cascading Style Sheets as well as Liquid scripting, having a theme in the Theme store is a great way to make money. It is probable that the first thing a new Shopify merchant will invest in is the look of their shop, hence a visit to the Theme store.</p>

<h3 id="app-store">App Store</h3>

<p>Like the Theme store, when Shopify released the API and paved the way for apps to be developed and integrated into shops, they created the <a href="http://apps.shopify.com/">App store</a> too. The Shopify mantra of keeping the core Shopify feature set simple ensures there is a useful place for custom Apps that can deliver any specific needed extras merchants may demand. There are hundreds of apps that can be installed in a shop and this number is sure to continue climbing as merchants express their needs.</p>

<p>For Shopify developers the App store presents their app to all the merchants as well as anyone researching the Shopify platform. To make the financial aspect of developing and servicing apps easier Shopify makes their billing API available to developers. In exchange for 20% of App profits Shopify collects the money from merchants directly and deposits it in the developer&#x2019;s Partner account. This is great for developers that do not have access to online credit card processing. It is possible for developers to setup one-time charges, recurring monthly charges and to not worry about payments. Shopify pays developers bi-weekly as of June 2012 making it very similar to working for a company.</p>

<h3 id="shopify-experts">Shopify Experts</h3>

<p>As the years have passed and Shopify has grown and attracted many more merchants it is only natural that a number of merchants will have needs that exceed the typical features provided by Shopify. These merchants need to know that they can have their special processing needs taken care of without having to launch a complex search for talent. The <a href="http://experts.shopify.com/">Shopify Experts</a> was launched to showcase talent working on the Shopify platform. Theme designers, App developers, photographers and even accountants can join and they get a chance to show off their portfolio and capabilities. The slots in the Experts showcase for accountants and photographers show these skills are also very much in demand by merchants that want to present the best possible look for their products and services, and to be able to do accurate reports on just what is flowing through their online universe.</p>

</div>
    <div class="chapter"><h2 id="shopify-developer-tools">Shopify Developer Tools</h2>

<p>As an engineer and software developer with some experience, over the years I have coded for many processors in many languages. From Z-80 Assembly language on the TRS-80&#x2019;s Zilog Z-80 8-bit CPU, through 6502, 6800 and 68000 chips, to Amiga 500, Sun Workstation C++ and then to PHP, Ruby and Javascript on homebrew Pentiums, the code editing tools used day to day have not varied much. Coding complex web applications on a laptop in a coffee shop is normal. For developers that want to create an App or build out a nice theme for a merchant all you need is an inexpensive laptop with Internet connectivity and the desire to learn.</p>

<h3 id="the-text-editor">The Text Editor</h3>

<p>Vim, Emacs, TextMate, UltraEdit, Sublime Text 2, Coda, Eclipse, Visual Studio, Notepad and the list goes on. Choosing a text editor is a very personal choice. I cannot touch type so I can offer no wisdom of choice. I get by with my horrid typing skills in the sense that I type at about the same speed as I think of code constructs. As long as my typing matches that speed I am happy. It is amazing to me when I see people writing code as they stare out the window at the coffee shop. If I was hiring a programmer I would use a typing skills test in the interview. Unsure of where that escape is? Are you sure you&#x2019;re a programmer? Back to the text editor itself. A text editor has to <em>syntax highlight</em> Ruby, Javascript, Liquid, Haml and Sass and other languages. It has to <em>autosave</em> all edits whenever typing stops and focus switchs to another task.</p>

<h3 id="the-web-browser">The Web Browser</h3>

<p>Obviously every developer needs a good web browser to work with, one that provides decent tools for examining the results of Shopify theme tweaks or interactions with web applications. All the major browsers these days are suitable however each brings certain quirks to the table. Currently Chrome, Safari and Firefox offer decent developer tools. IE remains a poor choice since there developer tools for IE remain second rate at best.</p>

<h3 id="versioning-your-work">Versioning Your Work</h3>

<p>Shopify will version templates as you change them. This built-in versioning system is not terribly useful for a team and certainly is not something you want to rely on for your only theme backup mechanism. Learning a distributed version control system (DVCS) like <em>git</em> is highly recommended. The <em>git</em> versioning system is a basic skill every developer should have that will payoff in spades. With git you can version <em>everything you work on</em>. Every line of code, every proposal, even binary work like images and assets that you might not ordinarily think of as something that should be under version control. Almost all the best open source projects are available using git and there is a serious community of developers all working and sharing code with git. <a href="http://github.com">Github</a> offers free accounts and comes highly recommended as one of the best places to host your code base.</p>

<h3 id="dropbox">Dropbox</h3>

<p>Dropbox is great way to cheaply share files and serves well for a workflow between small teams and clients. You can toss files into Dropbox and speed communications along and it beats managing large attachments in email. It has reasonable security most of the time too. More and more applications are being released with Dropbox connectivity so it makes sense to adopt this into any workflow that needs it.</p>

<h3 id="skitch">Skitch</h3>

<p>Screenshots remain a great way to start conversations about design and functionality. Skitch makes it easy to add notations to screenshots and then share the resulting image with a client. It can also be fun to Skitch invoices you sent to the client 2 months ago with the timestamped entry showing them logging in and seeing the invoice. Fire that image off to them and enjoy the mumbled excuses and apologies from their embarassment. Remarkably some clients are oblivious to their obligations and these are the ones to watch out for. Best to keep notes, printed and dates copies of agreements and to watch out for constantly changing requests. Some clients will accept an estimate for work, and once delivered they will suddenly change their requirements and expect the developer to go along with those changes.</p>

<h3 id="instant-messaging">Instant Messaging</h3>

<p>Using Skype, Adium, Pidgin, iChat or other messaging service can really make it easier to work with clients. Email does not cut it when you want to really rip through a work session with a client and bounce thoughts and ideas of off them. Screen sharing is one of the quickest ways to teach a client about what your App does, what the shiny buttons they can press do, and to showoff the overlooked luxuries you&#x2019;ve provided them. Writing a user manual for an App is fine too but that takes many hours and in the end the second you finish that manual it is likely outdated with defunct screen shots, descriptions and information as web apps can evolve in near real-time, even after they have been &#x201C;delivered&#x201D;. Re-factoring code is a constant process and that makes documentation development tough.</p>

<h3 id="terminal-mode-or-command-line-thinking">Terminal Mode or Command-Line Thinking</h3>

<p>Shopify makes a command-line (CLI) utility available that can be installed on any computer with the Ruby scripting language installed on it. The utility provides commands that allow a developer or designer to download a shop&#x2019;s theme for editing. Once downloaded the entire theme codebase can be checked into a version control system like git. There is also a command that tells the computer to watch for any changes in the theme files. If a change is detected in any files, including adding new ones those changes are automatically sent to the shop. You can simply refresh your browser and see the changes you just made. Even better there is a development tool called Live Reload that will auto-refresh your browser whenever changes are detected to the code that is currently being rendered in the browser meaning you can edit a theme or App, and then switch focus to your browser to see the results. As a developer learning to use the command line with skill and knowing how the operating system utilities work help is essential.</p>

<h3 id="localhost-development-on-a-laptop-desktop-or-other-devices">Localhost Development on a Laptop, Desktop or Other Devices</h3>

<p>With text editing, version control, and a web browser, a developer is ready to tackle almost any kind of Shopify project. To develop an application that can be hooked up to a merchant&#x2019;s shop it is imperative to be able to develop the application on your local machine. Testing a script out on a new concept or idea or running an entire App should not be tied to a server on the Internet. Being able to develop localhost when offline is crucial. Most common scripting languages used to develop web applications like Ruby and Python have nifty web servers for use on a local machine. Other languages get by with programs like Apache and Nginx. If you lose connectivity with the Internet at least you can keep developing and testing an App with this technique.</p>

<h3 id="pre-compiled-css">Pre-Compiled CSS</h3>

<p>A final tool for the Shopify developer that deserves more attention is the use of compiled CSS through the use of Less or Sass. Less can be compiled with Javascript and Sass is compiled with Ruby. The advantages are somewhat spectacular. A developer can build a complex theme using these tools and gain a lot of very important flexibility. Changing one value in Sass or Less and the change propagates throughout the CSS easily. Developing stylesheets by hand is clearly the least efficient methodology especially when a developer does have a good understanding of how CSS works.</p>

</div>
    <div class="chapter"><h2 id="common-questions">Common Questions</h2>

<p>There are plenty of reasons to choose a <em>hosted</em> platform like Shopify as the responsibility for the necessary implementation details of ensuring your shop&#x2019;s site is reachable by the public is purely Shopify&#x2019;s responsibility. By offering a platform that provides most of the basic features needed to run an e-commerce website Shopify has created a thriving community of shops that sell soup to nuts. It can be comforting to know that when an issue arises with respect to how to configure a shop that there are other people that have faced the same issue before and likely solved it. There is decent community support for most merchants new to the platform.</p>

<h3 id="how-to-capture-that-extra-information">How to Capture that Extra Information</h3>

<p>One of the earliest and still most common questions concerns how to capture custom information for products purchased in an order. There are thousands of shops that need to collect custom information. From glass baby bottles etched with a monogram, handbags with initials stitched into the leather, silver pendant jewelry with the name of the family dog or the newest twins on the block, the presentation of a form to collect this information is a source of endless discussion by merchants.</p>

<p>With the introduction of <em>cart attributes</em> it became possible but not necessarily simple to pass extra data through checkout with an order. The cart attributes are a simple key:value pair where a key is used to refer to some value. An order can have as many of these cart attributes to fully define needed product customization. A typical key might be the identification number of a product or variant. The value that can be stored with the key is usually a string of text. The following code presents a simple key and it&#x2019;s value.</p>
<div class="highlight"><pre><span class="nx">attribute</span><span class="p">[</span><span class="s1">'I_am_a_key'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"welcome to outer space astronaut!"</span>

<span class="nx">attribute</span><span class="p">[</span><span class="mi">12345678</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"David Bowie"</span>

<span class="nx">attribute</span><span class="p">[</span><span class="mi">44556677</span><span class="p">]</span> <span class="o">=</span> <span class="err">'</span><span class="p">[{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"qbf"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"jtld"</span><span class="p">},</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"lh"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"lnot"</span><span class="p">}]</span>
</pre>
</div>
<p>Those are three examples of setting a key and it&#x2019;s value. Using Javascript it is possible to experiment by setting a cart attribute and then checking that it was set correctly. Web browsers all provide Javascript and Javascript represents data and objects in a format called JSON. One excellent fact about this is that JSON can be stored as a text string and that means merchants and developers can create complex data structures and save them as cart attributes with any order! The third example presented shows this off. The cart attribute for ID 44556677 has been assigned a string of JSON. The value could be read as &#x201C;There are TWO 44556677 variants in the cart, one is named <em>qbf</em> and the other <em>jtld</em>&#x201D;. When rendering the cart to customers, it&#x2019;s possible to show these values in the appropriate line items along with the variants. The checked out order will display the same keys and values.</p>
<div class="highlight"><pre><span class="mi">44556677</span><span class="o">:</span> <span class="err">'</span><span class="p">[{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"qbf"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"jtld"</span><span class="p">},</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"lh"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"lneg"</span><span class="p">}]</span>
</pre>
</div>
<p>The previous script presented is a little confusing and some merchants might balk at having the customization information collected looking like that. It is possible to deal with this by approaching with more sophisticated code. Instead of directly storing the customization data in cart attributes it can be stored in a cookie or the web browsers built-in localStorage. During the creation and subsequent editing of customization information it is handled as JSON but before submitting the order to checkout the code can translate the JSON to plain english and then that would be set as the value in the cart attributes. As an example, if a variant represented a type of farm animal, for a selling price of $24.00, the attribute could be represented as:</p>
<div class="highlight"><pre><span class="nx">attribute</span><span class="p">[</span><span class="s2">"farm_animal"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Name: QBF, Action: JTLD, Name: LH, Action: LNOT"</span>
</pre>
</div>
<p>That is a more readable and could be interpreted by the merchant with little difficulty.</p>

<p>One important aspect of customization that should be addressed is that flexibility like this comes with a certain cost. While it does imply that you collect extra information for a product, you can lose certain inventory functionality when you use it. If you have the need to customize a product with four options, Shopify only has three, so you decide to collect the fourth option with a form field, and use the built-in options for the other three. When you make this choice, you lose the ability to keep track of inventory based on that fourth option. If that does not matter then it is not a problem. If price changes are involved there is no choice but to use the built-in options only to customize variants. This costs in terms of SKU&#x2019;s and there is a limit of up to 100 customized variants. A virtually unlimited amount of further customization is possible, but it should be applied to options that have no inherent cost or affect on inventory management.</p>

<h3 id="image-switching">Image Switching</h3>

<p>Shopify organizes a product by assigning it attributes like vendor, type and description. A product has no price itself but it does have variants, at least one default variant, and each variant has a price and can be setup within inventory to have options. A product also has images. You can upload many images for a product but there is no connection for those images directly to the variants!</p>

<p>If a merchant wants to present a product that comes in five colours, or perhaps seven different kinds of fabric then it is likely they will want to change the main image presented to the customer to match the selected variant. When looking at a t-shirt and selecting the colour blue a customer expects the t-shirt image to change to blue. A commong customization job concerns providing this to merchants. <a href="http://http://www.wallglamour.co.uk">Wall Glamour in the UK</a> is a simple example of this. When choosing any kind of wall stickers, you can click a colour palette and the main image changes to match. Another example would be <a href="http://www.polkadotwhat.com">Polka Dot What</a> where clicks on the left or right leg change the available thumbnail images and the main image.</p>

<p>The heart of the issue is when there are twenty variants and twenty product images uploaded, how do you connect them together? Recently Shopify introduced <em>alt</em> tag editing for product images that assigns provided text with the images. Images with alt attribute text is great for SEO and it can be used as a hook so that when variants are selected an image swap can occur. For novice theme developers the Shopify alt tag approach is pretty good. You might sacrifice SEO results for image swapping to present a nicer images when customer select different variants.</p>

<p>One cool aspect of swapping images is that all the images are readily available to Javascript from Liquid when you pass the product through the built-in Liquid <em>json</em> filter. Javascript code can access any image and use it as needed. With Javascript you can easily substitute different product image sizes and place them anywhere on the screen. Once the Liquid phase of rendering a product is done it can be left entirely to Javascript to make image swaps with nice effects like fades and other easing motions.</p>

<h3 id="cross-domain-support-with-jsonp-cors-or-iframe-elements">Cross-Domain Support with JSONP, CORS or iframe Elements</h3>

<p>Shopify is a hosted platform and all merchant shops are known by their myshopify_domain name combined with the <em>myshopify.com</em> root domain. You can use the domain name system (DNS) to help customers find your shop at any domain you want such as <em>www.mygreatshop.com</em>. It is still and forever <em>myshop.myshopify.com</em> for all intents and purposes too. If there is a reason to do an Ajax call to an App on a different domain (they usually will be since most Apps will be hosted in the cloud) how can one do that? Cross-domain ajax is possible using both CORS and JSONP. You can also use an HTML <em>iframe</em> element to embed a form in a shop. The cross-domain Ajax request is common and can be quite useful and serve as a support mechanism for sites that need it. To avoid JSONP and just use straight up Ajax an App needs to be created on a subdomain of the main shop. <em>app.mygreatshop.com</em> for example.</p>

<h3 id="special-invites">Special Invites</h3>

<p>Before the App store and lockdown apps like Gatekeeper were available it was really difficult to open up a shop and keep it locked down so that only registered customers could access the shop. It is possible to build Apps that present a form to captured a customer&#x2019;s email address and perhaps a secret code. The code and the URL of the App can be presented to all the customers you want to be able to access the shop. Each customer that types in the correct secret code and their email address would trigger the App to unlock the password protected shop using credentials only known to the App. If the App is on a subdomain of the shop the App could set the needed session cookie for a customer and seemlessly transfer them into an otherwise locked shop.</p>

<p>The customer account scripts provided with Shopify can also be setup to provide a modicum of security. There are a few supported patterns for customer account creation with Shopify. It remains to be seen if this has resulted in a better customer experience.</p>

</div>
    <div class="chapter"><h2 id="and-youre-wondering-about-clients">And You&#x2019;re Wondering About Clients?</h2>

<p>It is a good thing to wonder about your clients. The amazing thing about hanging out your shingle as a Shopify developer is the sheer unbridled variety of clients you will meet. If you are like me and enjoy sticking pins in maps, working with Shopify merchants will probably push you to buy a Costco size box of pins for your world map. Like the Ham Radio operators of yesteryear, collecting merchant shops from far off countries and cities to work on is neat. I still have no hits from Easter Island but I am holding out hope.</p>

<p>Before corporations caught on and heard all about the Internet, there was little or no online e-commerce. Amazon orders for books and cake decorating tools with next-day delivery to your door? Not much chance of that a mere decade or so ago. As Nortel sacrificed itself on the alter of corporate greed after laying fiber optic networks for everyone high speed Internet bootstrapped a new electronic goldrush age and <em>everyone</em> wants in on that action.</p>

<p>Some merchants understand that while Shopify does not try to offer everything to everybody, what it does offer is sufficient for most of their immediate needs. There are also plenty of merchants that approach Shopify with notions of what they <em>think</em> they need to succeed at e-commerce and so when you tell them Shopify does not support their needs directly and for free, they pop off like bottle rockets. These little conflicts are great and provide opportunity to argue from both sides of the fence. Some merchants make a good case but they cannot realistically use Shopify without sacrificing something fundamental in their business objectives. Internationalization is one of those issues. Many merchants need to serve their customers in more than one language and Shopify does not work in more than one language. Although these merchants are in the minority, the only resolution for them is to open up a shop per language and try and strike a deal with Shopify in the process. Luckily, since templates and inventory can be bulk exported and imported, this is less of a concern than it seems at first.</p>

<p>Some other examples of very common problems merchants point out:</p>

<ul><li>Shopify can&#x2019;t do one page checkout, oh my god that sucks!</li>

<li>I can&#x2019;t pre-program the Discount Code! Gah! That&#x2019;s terrible!</li>

<li>I can&#x2019;t just change the price by 10% when they order 2 or more? That is just wrong!</li>
</ul><p>After six years or so, we can be sure Shopify support staff are also pretty tired of hearing the same complaints. As time passes the Shopify platform has grown and extended in capabilities but it has shown a certain amount of resilience too. Faced with the choice of trying to do too much or just doing what it does do well, Shopify has embraced the philosophy of just doing what it does well.</p>

<h3 id="merchants-respond-to-clear-explanations">Merchants Respond to Clear Explanations</h3>

<p>A good way of explaining to merchants why they cannot have Shopify just add a feature they need is the story about Javascript, the lingua franca of all web browsers today. It was created by a programmer with lots of experience at developing languages in about 10 days. Today it is part of every smartphone, every iPad tablet and all desktop web browsers. For all the flaws Javascript has it remains much the same today as when it was created. It turns out that you cannot put the genie back in the bottle once it has been released. Shopify cannot undo the patterns laid down six years ago either. Software is probably mankind&#x2019;s most fiendishly difficult invention and so we have little choice but to go with what works for as long as possible. We do not want to tinker with a working formula. Right Coke? When they changed their formula they learned quickly the meaning of marketing department disaster.</p>

<p>If a merchant complains about checkout it is fair to ask them where they get the data supporting the case that one page checkout converts sales better than multipage checkouts. Are there enough Ph.D dissertations awarded that clearly show that result with certainty? Discount codes are another interesting trend these days. As Groupon and Living Social have demonstrated handing out coupons to people can be really good for increasing business. Shopify has one text input on the second page of checkout, and it cannot be scripted. Merchants have complained that this is not great and that customers are missing that field and making mistakes. It is hard to see how to really improve this process without a lot more experimentation and tweaking but soon enough, it will come to pass that checkout is made even easier.</p>

<h3 id="merchants-want-variable-pricing">Merchants Want Variable Pricing</h3>

<p>In Shopify, a product has no price. Only a product&#x2019;s variants have a price. A price on a variant cannot change at any point in a customer&#x2019;s shopping session. You cannot make a price higher or lower through any kind of scripting or fiddling. You just cannot do that. It often comes up that merchants will want to bundle products together and if a customer buys and entire bundle, it should result in cheaper prices for the products. Shopify does not work that way. If you bundle three products that cost $10 each together when they go in the cart they still cost $10 each. The bundle costs $30. It cannot be $25 if it is composed of three $10 products. The way to bundle products cheaper would be to make a product with all three products and price that product cheaper. That can be a difficult process for some merchants.</p>

<p>The <em>ideal merchant</em> will understand that opening an e-commerce shop is a tough business to start. Working with merchants you want to get them online, and making sales. They need to be found by search engines and they need customers. As customers find their shop and they make sales, it naturally becomes easier to show them that they can spend a little money on their theme and make their shop beautiful. They can then be convinced to take the next step and perhaps add some custom coding to make product customizations a reality and to use Apps to assist with order processing. It is rarely a one-size-fits-all strategy and often there are more than a couple of ways to use Shopify to make a sale.</p>

</div>
    <div class="chapter"><h2 id="shop-customizations">Shop Customizations</h2>

<p>Here are some Shopify customizations that have stood the test of time and that underline the flexibility of the Shopify platform.</p>

<p>A merchant launched his shop and met with initial success. So many orders came in that the merchant was up against a wall with the shop administration interface. He had one thousand orders that were all paid up and needed to be fulfilled. Those orders were from a short period of time like under a week. He wanted to know how to convert the task of individually fulfilling one thousand orders (totally stressing his wife out and that that in turn was stressing him out) into a single click. You can use the Shopify API to inject a link into the Orders Overview screen so an App was quickly built that would respond to a click and fulfill all the selected orders. His wife was no doubt pleased to be relieved of the burden of thousand click order fulfillment sessions.</p>

<p>Fulfilling orders in bulk is one small but handy use for the Shopify API. In talking of one thousand orders that brings up the important topic that the Shopify API has limits on how much any one App can use in a short period of time. An App has to stay within the limits and they are currently that an App can make 500 API calls in 300 seconds. If an App fulfilled 250 orders and then a second request came in moments later requesting 250 more orders be fulfilled followed shortly thereafter with another 250 orders the API limits would certainly be exceeded and the App would be blocked from using the API. This the important task a developer has to think of is ensuring these limits do not cause problems for merchants.</p>

<h3 id="using-delayed-jobs-to-manage-api-limits">Using Delayed Jobs to Manage API Limits</h3>

<p>Early attempts to work within the API limits resulted in code that would sleep for 300 seconds when the API limit was reached. This turned out to be awkward for many reasons. Keeping track with certainty that all App operations have completed without failure and counting API calls used up is prone to error. A better solution is to setup a delayed job and process API operations in the background. This turns out to be true of most Apps. You never want to lock up the user interface of an App while doing ten, thirty or more seconds of processing. That is not acceptable. Any created delayed jobs are run by a cheap worker processes that just wait around for jobs to do. Each API call to Shopify either succeeds or fails. If it fails because the API limits have been reached the delayed job can react to this exception and spawn a new delayed job in the future with the remaining work to do. Using this technique it is possible to process as many API calls as needed without limit problems and without slow locked up interfaces. It&#x2019;s a very elegant and robust system proven to work well by hundreds of thousands of successful API calls. Shopify itself performs all of the inventory import and export operations using delayed jobs.</p>

<p>The merchant had solved the fulfillment issue and now turned to other special issues. His products are perishable and they always get delivered on a Monday or Tuesday. When ordering the products customers wanted to order for more than one week. Customers are comfortable paying for an entire month of this product and so there was a need to figure out how to deal with this. Shopify does not currently support a recurring order or subscription service so the solution was to provide a quantity field for the product in the cart for each week a person wanted the product. A person could order one, two or up to four weeks of the product and pay just once for all the deliveries. By recording the delivery dates and quantities of each product ordered, it is possible to know exactly how many products get delivered per week per customer. Some customers order two or more per week so this had an immediate positive impact on the bottom line. There is even a button providing up to 3 months worth of future dates. Watching a merchant nail 15% higher sales with tweaks like this is rewarding.</p>

<h3 id="using-cart-attributes-and-webhooks-together">Using Cart Attributes and WebHooks Together</h3>

<p>Using a WebHook to capture paid orders an app can be used to inspect the line items and the cart attributes for quantities and dates per product. Setting up a small data structure to record the dates and quantities means the merchant can generate a nice Excel style grid of weekly deliveries with the ability to plan ahead. Once that step proved successful and many thousands of orders were being booked it turned out that the ability to fulfill orders automatically using the API was crucial. The reason is that since you can fulfill an order as many times as you want, an order that has deliveries in the future can be fulfilled <em>each</em> time a delivery comes up. When you use the API to fulfill an already fulfilled but still open order, the Shipping Confirmation email goes out, alerting the customer that their delivery is on the way. Only when all deliveries are completed does an order get closed. At that point it can even be removed from the app.</p>

<h3 id="adding-upsells-to-boost-sales">Adding Upsells to Boost Sales</h3>

<p>At this point the merchant&#x2019;s shop was running smooth and booking many thousands of orders per week. The merchant wanted to add a new feature to the shop. He wanted to <em>upsell</em> special products with the existing products. When Valentines Day rolls around it would be nice to offer a box of chocolates as an additional product. By creating a new product in Shopify and setting it&#x2019;s type to <em>upsell</em> the shop could offer this special product alongside the regular products. The App allows the shop to assign any products of type <strong>upsell</strong> to any other regular products. Using Liquid, if the regular product has been assigned any <strong>upsell</strong> products we can render them too. By presenting upsell products the shop was able to sell a huge amount of additional products per order. Upsells were an immediate hit. Using the API to customize the operation of a shop can really boost sales. One particular day saw an upsell convert on 1449 of 1450 carts. That is pretty impressive.</p>

<p>The pattern of upsells eventually moved back into a pure Shopify solution. Collection were created to hold the products of type upsell. Using a special <em>product.upsell.liquid</em> template when rendering products, it became possible to sell all the products in the collection with one add to cart button. This improvement did away with a lot of Ajax code and complexity and demonstrated that shops can truly go through periods of experimentation and evolution while still recording sales.</p>

<h3 id="adding-sms-notifications">Adding SMS Notifications</h3>

<p>With so many people using smartphones and SMS services, it made sense to add this to the shop fulfillment operations. It was easy enough to add a form to the shop&#x2019;s <em>Thank You</em> page asking the customer if they wanted an SMS message when their order was fulfilled. Remarkably a huge number of people have provided their SMS numbers and the App now sends an SMS to each customer when their order is fulfilled. Emails can sometimes be blocked by corporate firewalls and they proved to be less reliable.</p>

<p>This kind of customization illustrates how you can use the Shopify platform with confidence knowing that it can handle twists that get thrown into the typical mix of business use cases and scenarios that are customer driven. Other recent surprising experiences came from integrating Shopify with the well known Salesforce CRM system. It turns out that when you subscribe to Salesforce and want to send orders there they did not process the Shopify WebHook XML properly. A quick bridge was built by deploying an app to the cloud to accept WebHooks from Shopify and then having the App forward the order to Salesforce using XML formatted for Salesforce. Apps as a Proxy! Additionally Salesforce comes with some pretty severe limits on what you can do with an entry level plan. Sometimes it turns out that you can do better with an App running in the cloud, so bridging Shopify to an app and Salesforce has shown itself to be a pretty powerful but cost effective system too. Shopify is soon to release an approved SalesForce App so that will likely appeal to the CRM crowd.</p>

</div>
    <div class="chapter"><h2 id="shopify-inventory">Shopify Inventory</h2>

<p>When working out a development plan for a merchant&#x2019;s shop the inventory setup should come first and the theme should come last. Unfortunately many merchants jump into a theme only to realize later that while it looked good in theory, the reality is much different with their actual inventory. To achieve success a shop needs to present inventory in a way that complements a smooth shopping experience and that it is not gimmicks that sell. Sometimes deeper thinking about how a product and it&#x2019;s variants, pricing, images and options will dictate the best presentation and process. If the inventory is not organized correctly a lot of effort can be wasted trying to fix a theme up.</p>

<p>A product requires at a minimum only a title. The title will then be turned into a unique <em>handle</em> that is a reference to the product in the shop. A quick example is a product with the title <strong>Quick Brown Fox</strong>. Shopify will set a handle to this product as <strong>quick-brown-fox</strong> and the product will then be found online as the shop&#x2019;s URL appended with <em>/products/quick-brown-fox</em>. With no further action from a merchant a new product has been created and added to inventory with a zero dollar price, infinite inventory for sale, no tags, images, description or other useful attributes. It exists for the purposes of showing up on the site and can be accessed with an API call using the handle or ID it was assigned. You can <em>always</em> get the ID of a product simply by looking at the URL in the shop admin for the product when editing it. An example would be /admin/products/90368349 where the <em>903368349</em> is the unique ID for the product. As long as that product exists in the shop that number will never change. It is used during import and export operations to identify products that will need to be updated. It is also handy to use that number when quickly checking out a product with the API. For example to quickly see if a product has any metafields. A very quick but effective command-line effort would be:</p>
<div class="figure">
<img alt="Example API Call" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/api%20call2.png" /></div>
<p>With just a couple of keystrokes the product is shown and it has no metafield resources attached to it.</p>

<p>When setting up a product in inventory the variant can be assigned a title as well as a price, SKU and inventory management policies. Shopify also provides three options that can be assigned to a variant. If a product has a colour, size and material they are supported as variant options. These options can be anything so there is a fair amount of flexibility in using them. A product with attributes like density, plasticity, taste, style, or even chemical composition could be setup. Assuming all three options are used, Shopify allows a product to have up to 100 variants. This means a product with five colours, four sizes and three materials would require (5 x 4 x 3 = 60) sixty variants. Each one counts as an SKU in Shopify for the pricing plan selected. It is not necessary to assign an SKU to each variant, and you can assign the same SKU to as many variants as needed. Shopify simply treats the SKU as an attribute with no special meaning. Using the Shopify Ajax API it is very simple to use the handle of a product to get all of it&#x2019;s attributes. If we open up a store that has a version of the API code rendered as part of the theme, we can use the developer tools of our browser to inspect the details.</p>
<div class="figure">
<img alt="Getting Product Info using Ajax" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/ajax%20product2.png" /></div>
<p>An examination of the object representing a Shopify product shows us the structure of a product&#x2019;s options and how they are responsible for attributes generated for each variant. We can use this to completely customize the way Shopify renders products and variants. Many shops use the code Shopify provides to render each option as a separate HTML select element instead of one select element with each element separated with slashes. When a selection is made, a callback is triggered with the variant and that allows a shop to update things like pricing and availability. It is simple, reliable and it works. It can be relied on by developers to take front-end shop development to the next level beyond those basics.</p>

<p>If there are images uploaded for a product it is possible to detect images that might match the SKU assigned to the variant or perhaps the variant title. It is easy to make up some rules dictating how images that are uploaded for a product are coded so that code can be used in the callback logic.</p>

<h3 id="summary-of-developing-code-with-products">Summary of Developing Code with Products</h3>

<p>Knowing how Shopify inventory works with respect to variants and options is crucial to building out shops with advanced capabilities. To take a shop to a level where customers can easily add the product or products of their choice to the cart and buy it without guesswork or too much effort is essential. The first thing to keep in mind is that the product has options. There can be three. The have simple names like Colour, Size or Title. The product object you get from Liquid allows an inspection of the options array to see which ones are present. Every product can have different options so it makes sense to always have some code that checks the ones assigned to the product.</p>
<div class="highlight"><pre><span class="c1">// save product into a Javascript variable we can inspect.</span>
<span class="kd">var</span> <span class="nx">product</span> <span class="o">=</span> <span class="p">{{</span> <span class="nx">product</span> <span class="o">|</span> <span class="nx">json</span><span class="p">}};</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Product %o has Options %o"</span><span class="p">,</span> <span class="nx">product</span><span class="p">,</span> <span class="nx">product</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
</pre>
</div>
<p>When rendering with the Shopify <em>option</em>selectors_ code, there is a callback function that receives the selected variant. Logging that to the console shows the option values if the selected variant. A variant will always provide three attributes, option1, option2 and option3. If the value of the first product option was set to colour, the value of variant attribute option1 might be &#x201C;red&#x201D;. At the same time, the variant attribute called options, which is an array would have an entry where the first slot would be occupied by the value &#x201C;red&#x201D; too. So there are two ways to determine a variants current options.</p>

<p>At the same moment as the options are determined the variant ID is also known. Therefore it makes sense that if a shop needs to present clickable images, or buttons or swatches, all the elements are present to support code development for this. Hiding the usual dropdowns, rendering a clickable swatch that provides the variant options or even the ID can thus be used to ensure the correct item ends up in the cart. At some point it is likely to become a common option for shops to present clickable images or swatches.</p>

</div>
    <div class="chapter"><h2 id="the-shopify-api">The Shopify API</h2>

<p>One of the most interesting features of Internet computing that has evolved since the 1990&#x2019;s has been the introduction and growth of service oriented companies that work strictly using Internet protocols. YouTube, Twitter, Facebook, Shopify and multitudes of other companies that run from modest brick and mortar headquarters, have relatively small employee head counts but count millions and perhaps billions of users. Little of their success can be attributed to pounding the pavement door to door or by TV advertising. Service oriented companies leverage the Internet itself for their growth and one of the underlying reasons for their rapid growth, adoption and success is due the concept of the public API or Application Programming Interface.</p>

<p>What better way to introduce the public to a service than to allow them to build it, populate it and enjoy it using their own labour and tools. YouTube, Facebook and Twitter would not exist without user generated content. How to ensure everyone can contribute to your service without being overly technical or specialized? How to accept a video from an iPhone or Android phone, an iPad or Galaxy Tablet, a Mac or a PC? The key is the use and promotion of an API. Provide a simple mechanism everyone can take advantage of and the ball starts rolling.</p>

<p>Shopify released their API platform after some years of processing a steadily growing number of transactions (perhaps some would see it as explosive growth). A period of time during which Shopify learned not only to understand the intimate details of what happens when millions of dollars flow through Internet cash registers, but also the huge number of possibilities and limitations that can be faced by a single codebase. Once the early adopter merchants crossed the chasm and became profitable enterprises there was a corresponding demand and need for introducing better order processing.</p>

<p>The API platform uses the software architecture known as <strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer (REST) accepted by a majority of the Internet community. The API provides support for merchants to create, read, update or delete all the the resources of their shop, like products for example. One current limitation is that you cannot programmatically create an order, due to security concerns around credit card numbers. Almost all e-commerce companies offer some sort of API but there is a clearly a difference in the degree of maturity and the amount of thought that has gone into some of them. The Shopify API is proving to be very helpful for merchants that need advanced capabilities. Whenever the general question is asked &#x201C;Can Shopify do such and such?&#x201D;, the right answer to the question is usually &#x201C;Yes it can, you need to use the API for that custom functionality or feature.&#x201D;</p>

<p>Shopify has established a hosted e-commerce platform transacting hundreds of millions of dollars per year for tens of thousands of merchants. If all the many requested features those merchants demanded were added to the core of Shopify, the platform would become unstable and prone to outages, breakdowns and a destroyed reputation for reliability. Developers would have to become familiar with a constantly changing system. By offering an API built around a core set of resources Shopify has enabled an ecosystem of App developers to come together and create unique and necessary offerings to make running an e-commerce shop on the Shopify platform easier for merchants. Developers need only learn the API and they can then apply their knowledge to any shop for any merchant.</p>

<p>A good example of extending a shop for a merchant is the task of fulfilling an order using the API and an App. Shopify has an option allowing a merchant to select from a few fulfillment companies. What happens when you check out that short list and you do not see an acceptable option? Your supply chain from manufacturer DrubbleZook to warehouse Zingoblork with shipper USPS or Royal Mail is simply not there. But you know every single order can be sent to an App. You know you can select up to 250 orders at once and send them all to an App. So surely an App can be built to handle the fulfillments automatically. An App running in the cloud listening 24/7 for incoming orders. And when it gets an order it robotically follows a set of instructions that ensures the merchant is going to be happy. The App takes the order apart and inspects it. The App knows where each line item is to be sent. It knows the ID of every variant, and whether a discount code was used. It knows the credit card issuer. The App can take the order details and format it for Zingoblork and their special needsm, in a special XML format just for Zingoblork. It is 2012 and the Zingoblork warehouse system runs off of any of the following data exchange mechanisms:</p>

<ul><li>a Microsoft DOS server, connected to the Internet by FTP. They only accept CSV files via FTP</li>

<li>a Microsoft NT Server, connected to the Internet by sFTP. They only accept CSV files via sFTP</li>

<li>Email. The company can only deal with email. They have been around forty years, and it&#x2019;s all email all the time</li>

<li>HTTP POST. A modern miracle! A warehouse fulfillment company that actually has modern infrastructure!</li>

<li>EDI which we won&#x2019;t even bother to describe, but suffice it to say, the Chevy Vega of exchanges</li>

<li>SOAP protocol, for those who would rather wash the car with a toothbrush.</li>
</ul><p>The app receives fresh orders thanks to the API and WebHooks. It processes them and sends them off to the fulfillment company. Once the fulfillment company has accepted the order(s) and sent them off to their final destination as a delivery, the customer needs to know. Some companies will collect all the orders they process for a shop and create a daily manifest of tracking codes assigned to the orders and place those in a holding pen accessible only by a special FTP account. Others will send the tracking numbers to the merchant via email completely destroying the merchant&#x2019;s email inbox and sanity. The best fulfillment companies will send the tracking numbers and order ID directly back to the App, thus allowing the App to automatically create a fulfillment using the API with the tracking number. Shopify automatically detects the creation of a fulfillment and sends the appropriate email. This is wonderful since the App and the API together can close the loop automatically. Once fulfilled, the App closes the order and the merchant has not lifted a finger.</p>

<p>Without an API it would be hard to offer this level of customization to a merchant. Another interesting use of Shopify is when a merchant opens up to sell products on a consignment basis for external vendors. If a merchant accepts 1000 widgets to sell for $20 each, the vendor wants to know if the shop made $20, $400 or even $4000 in sales. If the merchant accepts 1000 widgets to sell on behalf of 20 or 30 different vendors his merchant life will almost certainly be miserable unless the API is used to facilitate the reporting needed. An App records each and every line item sold as a Sale that is assigned to the vendor. Every product has a selling price and a cost price and the difference between those is the profit to be split between the merchant and the vendor(s). The deal with the vendors is to give them an 80/20 split on profits, or perhaps 60/40 splits of that profit. That percentage can be assigned to each sale so that different deals can be made depending on the day of the week, the colour of the sky or the popularity of the product. That is an App that can be plugged into a shop today. None of that is possible without the API.</p>

<p>The presence and functionality of the Shopify API is crucial to consider in the decision most enterprises work out before going into business with the Shopify platform. If a merchant knows the fixed costs to run a shop for a year are $1000 and that their theme will cost them $5000, the API is the only other option that deserves attention. Adding an App can add to the cost of running a shop, but they can also save hundreds of hours in manual labour. Paying for a custom App to be developed to address a special need can cost a few thousand dollars but can result in measurable growth in sales. Many companies are looking for a reliable hosted e-commerce platform and partner(s) to work with to bring their e-commerce vision to life. The presence and capabilities of the Shopify APIis enough incentive to choose Shopify over competing platforms.</p>

</div>
    <div class="chapter"><h2 id="how-to-handle-webhook-requests">How to Handle Webhook Requests</h2>

<p>This is a big important topic. If Shopify doesn&#x2019;t receive a 200 OK status response within 10 seconds of sending a WebHook, Shopify will assume there is a problem and will mark it as a failed attempt. Repeated attempts will be made for up to 48 hours. Too many failures and the WebHook is deleted. A common cause for failure is an App that performs too much complex processing when it receives request before responding. When processing WebHooks a quick 200 OK response that acknowledges receipt of the data is essential.</p>

<p>Here&#x2019;s some pseudocode demonstrating what I mean:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">handle_webhook</span> <span class="n">request</span>
  <span class="n">process_data</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>    <span class="c1"># Note that the process_data call could take a lot of time, perhaps 2-6 seconds</span>
  <span class="n">status</span> <span class="mi">200</span>
<span class="k">end</span>
</pre>
</div>
<p>To make sure that you don&#x2019;t take too long before responding you should defer processing the WebHook data until <em>after</em> the response has been sent. Delayed or background jobs are perfect for this.</p>

<p>Here&#x2019;s how your code could look:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">handle_webhook</span> <span class="n">request</span>
  <span class="n">schedule_processing</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>    <span class="c1"># this takes no time so the response is quick</span>
  <span class="n">status</span> <span class="mi">200</span>
<span class="k">end</span>
</pre>
</div>
<p>Even if you&#x2019;re only doing a small amount of processing there are other factors to take into account. On-demand cloud services such as Heroku or PHPFog will need to spin up a new processing node to handle sporadic requests since they often put Apps to sleep when they are not busy. This can take several seconds. If your App is only spending five seconds processing data it will still <em>fail</em> if the underlying server took five seconds to start up.</p>

<h3 id="the-interesting-world-of-webhooks">The Interesting World of WebHooks</h3>

<p>Shopify does a fine job of introducing and explaining WebHooks on the wiki, and there are some pretty nifty use cases provided. The <em>best practices</em> are essential reading and should be thoroughly understood to get the most out of using WebHooks. There are all sorts of interesting issues with WebHooks.</p>

<p><a href="http://wiki.shopify.com/WebHook#How_Should_I_Handle_Webhook_Requests">Shopify WebHooks Documentation</a></p>

<p>When you are dealing with Shopify Webhooks you are in the Email &amp; Preferences section of a shop. You can setup a WebHook using the web interface. Pick the type of WebHook you want to use and provide a URL that will be receiving the data. For those without an App to hook up to a shop there are some nifty WebHook testing sites available that are free to use. Let&#x2019;s take one quick example and use RequestBin. The first thing to do is create a WebHook listener at the <a href="http://requestb.in/" title="RequestBin">Request Bin</a> website.</p>
<div class="figure">
<img alt="Create a new RequestBin for your WebHook" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/request_bin_home2.png" /></div>
<p>Pressing the <em>Create a RequestBin</em> button creates a new WebHook listener. The result is a generated URL that can be used for testing. Note that one can also make this test private so that only you can see the results of WebHooks sent to the RequestBin.</p>
<div class="figure">
<img alt="Newly Created RequestBin" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/request_bin_created2.png" /></div>
<p>The RequestBin listener is the URL that can be copied into the Shopify Webhook creation form at the shop&#x2019;s Email &amp; Preferences administration section. http://www.postbin.org/155tzv2 where the code <strong>155tzv2</strong> was generated just for this test. Using the WebHook create form one can pick the type of WebHook to test and specify where to send it.</p>
<div class="figure">
<img alt="WebHook Created in Shopify Email and Preferences" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/webhook_created2.png" /></div>
<p>When the WebHook has been created you can send it to the RequestBin service any time by clicking on the <strong>send test notification</strong> link and standing by for a confirmation that it was indeed sent.</p>
<div class="figure">
<img alt="Testable WebHook" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/webhook_testable2.png" /></div>
<p>The links to delete a WebHook as well as test are beside each other. Exercise some caution when click in this neighborhood! It is easy to accidentally press the trashcan icon and remove a WebHook that should <em>never be removed</em>. Ooops! It can take only seconds of carelessness to decouple a shop from a crucial App.</p>

<p>Sending a test is easy, and the result should be immediately available in RequestBin. The example shows a test order in JSON format.</p>
<div class="figure">
<img alt="WebHook Results" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/webhook_results2.png" /></div>
<p>Looking closely at the sample order data which is in JSON format there is a complete order to work with. The loop is loop is closed on the concept of creating, testing and capturing WebHooks. The listener at RequestBin is a surrogate for a real one that would exist in an App but it can prove useful as a development tool.</p>

<p>For the discussion of WebHook testing note that the sample data from Shopify is good for testing connectivity but not so much for testing an App. Close examination of the provided data shows a lot of the fields are empty or null. It would be nice to be able send real data to an App without the hassle of actually using the shop and booking orders. A real scenario might be to test and establish:</p>

<ol><li>Ensure the WebHook order data actually came from Shopify, and that you have the source shop correctly identified.</li>

<li>Ensure there is not already an identical order as it makes no sense to process a <em>PAID</em> order two or more times.</li>

<li>Parsing out the credit card used, and the shipping charges, and the discount codes used if any is needed.</li>

<li>Parsing out any product customization data in the cart note or cart attributes.</li>
</ol><p>This small list introduces some issues that may not be obvious to new developers to the Shopify platform. Addressing each one will provide some useful insight into how to structure an App to deal with real WebHooks from Shopify.</p>

<h3 id="webhook-validation">WebHook Validation</h3>

<p>When setting up an App in the Shopify Partner web application the key attributes generated by Shopify for the App is the authentication data. Every App has an API key to identify it as well as a shared secret. These are unique tokens and they are critical to providing a secure exchange of data between Apps and Shopify. In the case of validating the source of a WebHook, both Shopify and the App can use the shared secret. When you use the API to install a WebHook into a Shop, Shopify knows the identity of the App requesting the WebHook to be created, so Shopify uses the shared secret associated with the App and makes it part of the WebHook itself. Before Shopify sends off a WebHook created by an App it will be use the shared secret to compute a Hash of the WebHook payload and embed this in the WebHook&#x2019;s HTTP headers. Any WebHook from Shopify that has been setup with the API will have HTTP_X_SHOPIFY_HMAC_SHA256 in the HTTP request header. Since the App has access to the shared secret it can use that to decode the incoming request. The Shopify team provides some working code for this.</p>
<div class="highlight"><pre><span class="no">SHARED_SECRET</span> <span class="o">=</span> <span class="s2">"f10ad00c67b72550854a34dc166d9161"</span>
<span class="k">def</span> <span class="nf">verify_webhook</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hmac_header</span><span class="p">)</span>
  <span class="n">digest</span>  <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">Digest</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">)</span>
  <span class="n">hmac</span>    <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="no">SHARED_SECRET</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span>
  <span class="n">hmac</span> <span class="o">==</span> <span class="n">hmac_header</span>
<span class="k">end</span>
</pre>
</div>
<p>The App calculates a value only it could know. The header provides a value from Shopify If the two computed values match, it is assured the WebHook is valid and came from Shopify. That is why it is important to ensure the shared secret is not widely distrubuted on the Internet.</p>

<h3 id="looking-out-for-duplicate-webhooks">Looking out for Duplicate Webhooks</h3>

<p>As explained in the WebHook best practices guide, Shopify will send a WebHook out and then wait up to ten seconds for a response status. If that response is not received the WebHook will be resent. This continues until a 200 OK status is received ensuring that even if a network connection is down or some other problem is present Shopify will keep trying to get the WebHook to the App. The initial interval between retries of ten seconds is not practical for a large number of retries so the time interval between requests is constantly extended until the WebHook is only retried every hour or more. If nothing changes within 48 hours an email is sent to the App owner warning them their WebHook receiver is not working and that the WebHook itself will be deleted from the shop. This can have harsh consequences, mitigated by the fact that the email should be sufficient to alert the App owner to the existence of a problem.</p>

<p>Assuming all is well with the network and the App is receiving WebHooks it is entirely possible that an App will receive the odd duplicate WebHook. Shopify is originating WebHook requests in a Data Center and there are certainly going to be hops through various Internet routers as the WebHook traverses various links to your App. If you use the tracert command to examine these hops you can see the latency or time it takes for each hop. Sometimes, an overloaded router in the path will take a long time to forward the needed data extending the time it takes for a complete exchange between Shopify and an App. Sometimes the App itself can take a long time to process a WebHook and respond. In any case a duplicate is possible and the App might have a problem unless it deals with the possibility of duplicates.</p>

<p>A simple way to deal with this might be to have the App record the ID of the incoming WebHook resource. For example, on a paid order if the App knows apriori that order 123456 is already processed, any further orders detected with the ID 123456 can be ignored. Turns out in practice this is not a robust solution. A busy shop can inundate an App with orders/paid WebHooks and at any moment no matter how efficient the App is at processing those incoming WebHooks, there can be enough latency to ensure Shopify sends a duplicate order out.</p>

<p>A robust way to handle WebHooks is to put in place a Message Queue (MQ) service. All incoming WebHooks should be directed to a message queue. Once an incoming WebHook is successfully added to the queue the App simply returns the 200 Status OK response to Shopify and the WebHook is completed. If that process is subject to network latency or other issues it makes no difference as the queue welcomes any and all WebHooks, duplicates or not.</p>

<p>The App has a queue worker process used to <em>pop</em> WebHooks from the queue for processing. There is no longer a concern over processing speed and the App can do all the sophisticated processing it needs to do. It is possible to be certain whether a WebHook has been processed already or not. Duplicated WebHooks are best taken care of with this kind of architecture.</p>

<h3 id="parsing-webhooks">Parsing WebHooks</h3>

<p>Shopify provides WebHook requests as XML or JSON. Most scripting languages have XML and JSON parsers to make request processing easy. With the advent of NoSQL databases, storing JSON as documents in CouchDB or MongoDB is possible. It is also easy to use Node.js on the server to process WebHooks where JSON is a natural fit. Since the logic of searching a request for a specific field is the same for both formats, it is up to the App author to choose the format they prefer.</p>

<h3 id="cart-customization">Cart Customization</h3>

<p>Without a doubt one of the most useful but also a more difficult aspect of front end Shopify development is in the use of the cart note and cart attribute features. They are the only way a shop can collect non-standard information from a customer. Any monogrammed handbags, initialed wedding invitations, engraved glass baby bottles etc. will have used the cart note or cart attributes to capture this information and pass it through the order process. Since a cart note or cart attribute is just a key and value, the value is restricted to a string. A string could be a simple name like &#x201C;Bob&#x201D; or it could conceivably be a sophisticated Javascript Object like &#x201D;<span>{&#x201C;name&#x201D;: &#x201C;Joe Blow&#x201D;, &#x201C;age&#x201D; : &#x201C;29&#x201D;, &#x201C;dob&#x201D;: &#x201C;1958-01-29&#x201D;},{&#x201C;name&#x201D;: &#x201C;Henrietta Booger&#x201D;, &#x201C;age&#x201D; : &#x201C;19&#x201D;, &#x201C;dob&#x201D;: &#x201C;1978-05-21&#x201D;},..{&#x201C;name&#x201D;: &#x201C;Psilly Psilon&#x201D;, &#x201C;age&#x201D; : &#x201C;39&#x201D;, &#x201C;dob&#x201D;: &#x201C;1968-06-03&#x201D;}</span>&#x201D;. In the App, when parsing cart attributes with JSON, it is possible to reconstitute the original object embedded there. This pattern of augmenting orders with cart attributes, passing them to Apps by WebHook for processing has made it possible for the Shopify platform to deliver a wide variety of sites with unique features.</p>

</div>
    <div class="chapter"><h2 id="command-line-shopify">Command Line Shopify</h2>

<p>Development of Apps requires being able to fire off requests to a shop and to be able to process the responses. WebHooks are a source of incoming data from a Shop but there are many interesting possibilities available using a console terminal to access the API at the command line.</p>

<p>Firing off a request for a resource to a Shop uses JSON or XML and it occurs with a standard HTTP verb like GET. To send a GET request to a shop with authentication is an involved process using the command line. A curl command to send of a request to a Shop for a product or collection resource is somewhat complex. Who memorizes curl commands? It is tedious. There are better ways to do this.</p>

<p>Shopify has a super application they bundle with their Ruby gem for the Shopify API. Before Rails merged with Merb, the Merbists advanced the concept of command-line interface (CLI) development for Ruby with the introduction of Thor. Thor is Ruby code that generates command-line interfaces and is a nice replacement for rake tasks. The new command is simple <em>shopify</em>.</p>

<p>Start a terminal session on your computer and you will be able to test this command out. You do know the console and you do want to have the Ruby scripting language and the shopify api gem installed.</p>
<div class="figure">
<img alt="Available Options for the shopify Command Line Interface" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/CLI2.png" /></div>
<h3 id="the-shopify-command-line-console">The shopify Command Line Console</h3>

<p>There are just a few options listed and in order to really cook up some interesting examples use the configure option that comes with the command. The arguments required to configure a shopify session are the shop&#x2019;s API key and a password. To get those values, use the shop itself. For some developers this will mean using their development shop, and for others, their clients have provided access to their shop so a private App can be created, or they created the Private App for the developer and passed on the credentials. The following screen shots show the exact sequence.</p>
<div class="figure">
<img alt="Menu Options to Setup Shop Access for the Command Line" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/Manage%20Apps2.png" /></div><div class="figure">
<img alt="Setting Up Access for a Private Application" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/Private%20Application2.png" /></div><div class="figure">
<img alt="Final Step Reveals the Needed Access Credentials" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/Private%20App.png" /></div>
<p>When examining the credentials provided for a Private App Tool, use the API key and password along with the shop name. Once the configuration is completed access the shop using a console is easy.</p>

<p>The following figure is a console session for a development shop showing a query for the shop&#x2019;s count of products, orders, and the details of a single order.</p>
<div class="figure">
<img alt="Output of Calling a Shop Using the API" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/shopify_console.png" /></div>
<p>Testing out potential code snippets quickly without incurring a lot of overhead is a huge benefit. API code can be tested with the fewest possible keystrokes and minimum effort with this handy console. It is possible to access metafield resources by providing an ID for the resource. The syntax of a call with Active Resource can be a challenge to keep in your head. With the console it&#x2019;s possible to try command syntax out to see what the exact response is. With the console it is easier to try a few different call patterns until stumbling on the desired one.</p>

<p>You can add connections to as many shops as needed and you can list them all. When working on a client shop one of the first things to do is to use the shop admin interface and the App tab to create a private tool. The console is super useful to quickly test out any custom queries to build into an App for the merchant.</p>

<h3 id="the-shopify-theme-command-line-console">The Shopify Theme Command Line Console</h3>

<p>A second useful command line tool that Shopify provides is not in the shopify_api gem but is a separate gem called shopify_theme. With this gem installed on a system you can use the command <strong>theme</strong> to develop the shop theme. Theme offers a simple workflow. The first thing to do with a shop development project is to create a directory to hold all the files that make up the merchant&#x2019;s theme.</p>

<pre><code>$ mkdir fizz-buzz.com
$ cd fizz-buzz.com
$ theme configuration</code></pre>
<div class="figure">
<img alt="Output of the Theme Command Line Console" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/theme%20console2.png" /></div>
<p>The listing of available options and arguments to the <em>theme</em> commmand is slightly different from the <em>shopify</em> command. It does use the same API key and password to access shop resources. The configuration is saved as a file config.yml. The first step useful step once configured is to download the complete theme. $ theme download</p>

<p>Once the assets are downloaded setup the files under version control. Make a local repository with git and store the client&#x2019;s code under version control for safety. Advanced developers might even add a git remote pointing at github so that all work is safely stored in a private repository there too.</p>

<pre><code>$ git init
$ git add .
$ git commit -m 'initial commit of Shopify code for client XYZ'</code></pre>

<p>With the code in git it is a great time to start working on the theme. Use the <em>theme watch</em> command to <em>watch</em> the directory for any changes. As soon as a change is registered to a file, the theme watcher will transmit the changed file to the client site where the file was downloaded from. Any changes can be stored in git, ensuring a smooth and hassle free development experience.</p>

<pre><code>$ git commit -am 'Fixed that pesky jQuery error the client had from blindly copy and pasting some bad code off the Internet'</code></pre>

<p>This is a very productive and safe workflow. The code is under version control and it is easy to edit theme code using your favorite tools. If in the future the client wants more work done you just use the <em>theme download</em> command to grab new files or changes to files initiated by the merchant or others. Git will keep track of all changes. You have a fighting chance when you are not the only person touching or editing a merchant site. Squashing some other designers work or other persons files is rarely an acceptable practice!</p>

</div>
  
    </div>

    <div class="imprint container">
      <div>
        <h2>A Developer's View of the Shopify Platform</h2>
        <p>David Lazar, P.Eng</p>
        <p>Copyright (C) 2012 David Lazar.</p>
      </div>
    </div>
  </body>
</html>
