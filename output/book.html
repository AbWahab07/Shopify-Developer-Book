<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
  <head>
    <title>A Developer's View of the Shopify Platform</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../templates/html/stylesheets/layout.css"/>
    <meta name="author" content="David Lazar" />
    <meta name="subject" content="A brief history of customizing Shopify" />
    <meta name="keywords" content="Shopify, software development, API, Javascript, Ruby, cloud computing" />
    <meta name="date" content="2012-04-10" />
  </head>
  <body>
    <div class="frontcover container">
      <div>
        <h1>A Developer's View of the Shopify Platform</h1>
        <p class="description">A brief history of customizing Shopify</p>
        <p class="authors">David Lazar</p>
      </div>
    </div>

    <div class="table-of-contents">
      <h2 class="no-toc">Table of Contents</h2>
      <div id="toc">
        <div class="level3 forward"><a href="#forward"><span>Forward</span></a></div><div class="level3 preface"><a href="#preface"><span>Preface</span></a></div><div class="level3 acknowledgements"><a href="#acknowledgements"><span>Acknowledgements</span></a></div><div class="level3 who-is-this-ebook-for"><a href="#who-is-this-ebook-for"><span>Who is this eBook For?</span></a></div><div class="level3 what-is-assumed-by-the-author"><a href="#what-is-assumed-by-the-author"><span>What is Assumed by the Author</span></a></div><div class="level3 about-the-author"><a href="#about-the-author"><span>About the Author</span></a></div><div class="level3 finding-shopify-what-a-relief"><a href="#finding-shopify-what-a-relief"><span>Finding Shopify, What a Relief!</span></a></div><div class="level2 the-shopify-platform"><a href="#the-shopify-platform"><span>The Shopify Platform</span></a></div><div class="level3 shop-administration"><a href="#shop-administration"><span>Shop Administration</span></a></div><div class="level3 liquid-templating"><a href="#liquid-templating"><span>Liquid Templating</span></a></div><div class="level3 javascript-api"><a href="#javascript-api"><span>Javascript API</span></a></div><div class="level3 shopify-api"><a href="#shopify-api"><span>Shopify API</span></a></div><div class="level3 theme-store"><a href="#theme-store"><span>Theme Store</span></a></div><div class="level3 app-store"><a href="#app-store"><span>App Store</span></a></div><div class="level3 shopify-experts"><a href="#shopify-experts"><span>Shopify Experts</span></a></div><div class="level2 shopify-developer-tools"><a href="#shopify-developer-tools"><span>Shopify Developer Tools</span></a></div><div class="level3 the-text-editor"><a href="#the-text-editor"><span>The Text Editor</span></a></div><div class="level3 the-web-browser"><a href="#the-web-browser"><span>The Web Browser</span></a></div><div class="level3 versioning-your-work"><a href="#versioning-your-work"><span>Versioning Your Work</span></a></div><div class="level3 dropbox"><a href="#dropbox"><span>Dropbox</span></a></div><div class="level3 skitch"><a href="#skitch"><span>Skitch</span></a></div><div class="level3 instant-messaging"><a href="#instant-messaging"><span>Instant Messaging</span></a></div><div class="level3 terminal-mode-or-command-line-thinking"><a href="#terminal-mode-or-command-line-thinking"><span>Terminal Mode or Command-Line Thinking</span></a></div><div class="level3 localhost-development-on-a-laptop-desktop-or-other-devices"><a href="#localhost-development-on-a-laptop-desktop-or-other-devices"><span>Localhost Development on a Laptop, Desktop or Other Devices</span></a></div><div class="level3 pre-compiled-css"><a href="#pre-compiled-css"><span>Pre-Compiled CSS</span></a></div><div class="level2 common-questions"><a href="#common-questions"><span>Common Questions</span></a></div><div class="level3 how-to-capture-that-extra-information"><a href="#how-to-capture-that-extra-information"><span>How to Capture that Extra Information</span></a></div><div class="level3 image-switching"><a href="#image-switching"><span>Image Switching</span></a></div><div class="level3 jsonp"><a href="#jsonp"><span>JSONP</span></a></div><div class="level3 special-invites"><a href="#special-invites"><span>Special Invites</span></a></div><div class="level2 and-youre-wondering-about-clients"><a href="#and-youre-wondering-about-clients"><span>And Youâ€™re Wondering About Clients?</span></a></div><div class="level3 clients-respond-to-clear-explanations"><a href="#clients-respond-to-clear-explanations"><span>Clients Respond to Clear Explanations</span></a></div><div class="level3 i-want-variable-pricing"><a href="#i-want-variable-pricing"><span>I Want Variable Pricing</span></a></div><div class="level2 shop-customizations"><a href="#shop-customizations"><span>Shop Customizations</span></a></div><div class="level3 using-delayed-jobs-to-manage-api-limits"><a href="#using-delayed-jobs-to-manage-api-limits"><span>Using Delayed Jobs to Manage API Limits</span></a></div><div class="level3 using-cart-attributes-and-webhooks-together"><a href="#using-cart-attributes-and-webhooks-together"><span>Using Cart Attributes and WebHooks Together</span></a></div><div class="level3 adding-upsells-to-boost-sales"><a href="#adding-upsells-to-boost-sales"><span>Adding Upsells to Boost Sales</span></a></div><div class="level3 adding-sms-notifications"><a href="#adding-sms-notifications"><span>Adding SMS Notifications</span></a></div><div class="level2 shopify-inventory"><a href="#shopify-inventory"><span>Shopify Inventory</span></a></div><div class="level2 the-shopify-api"><a href="#the-shopify-api"><span>The Shopify API</span></a></div><div class="level2 how-to-handle-webhook-requests"><a href="#how-to-handle-webhook-requests"><span>How to Handle Webhook Requests</span></a></div><div class="level3 the-interesting-world-of-webhooks"><a href="#the-interesting-world-of-webhooks"><span>The Interesting World of WebHooks</span></a></div><div class="level3 webhook-validation"><a href="#webhook-validation"><span>WebHook Validation</span></a></div><div class="level3 looking-out-for-duplicate-webhooks"><a href="#looking-out-for-duplicate-webhooks"><span>Looking out for Duplicate Webhooks</span></a></div><div class="level3 parsing-webhooks"><a href="#parsing-webhooks"><span>Parsing WebHooks</span></a></div><div class="level3 cart-customization"><a href="#cart-customization"><span>Cart Customization</span></a></div><div class="level2 command-line-shopify"><a href="#command-line-shopify"><span>Command Line Shopify</span></a></div><div class="level3 the-shopify-command-line-console"><a href="#the-shopify-command-line-console"><span>The shopify Command Line Console</span></a></div><div class="level3 the-shopify-theme-command-line-console"><a href="#the-shopify-theme-command-line-console"><span>The Shopify Theme Command Line Console</span></a></div>
      </div>
    </div>

    <div id="chapters">
      
    <div class="chapter"><h3 id="forward">Forward</h3>

<h3 id="preface">Preface</h3>

<p>I like to think that I don&#x2019;t really mark time with much enthusiasm or rigour. When I began my professional career developing code to non-destructively test steel bridges for structural integrity, I marked off eight years before I sensed I had done enough crazy climbing and driving and that I needed a break. I spent a good five years around the dotcom bubble renting a nice office with good friends trying to make web apps. Then I spent five more years taking on a variety of consulting gigs that in the end never amounted to a hill of beans but taught me how to wear many various business hats. I picked up the Shopify bug and tried working with a boutique web agency. As five more years passed, I realized that I knew a lot about being an independent computer business, and that I knew a lot about tricking out Shopify for an ever growing list of clients. I have yet to give myself an official work title, nor have I declared my intentions or loyalty to any one type of computing and my Corporation is pretty much a sad sack but expensive accounting exercise I leave to those who get a kick out that kind of thing. I am sure it&#x2019;s going to reach a decade in age as neglected as my vinyl collection. One needs a corporation though to run off invoices and interact with clients in foreign nations, so I go along with that. Dividends anyone?</p>

<p>A beautiful autumn day in Montreal and Shopify came for a visit with their CTO Cody, Joey Devilla on the Accordion and Edward the king of the API, with much swag and the company credit cards to cover the beer bill. We owe that to Meeech who organized it all and attracted a small but curious crowd of locals to hear more about Shopify. I decided at that time to pitch this effort, an eBook written from the perspective of a developer with a lot of experience working on Shopify, but not working for Shopify. Over the years my nom de plume of Hunkybill on the Shopify public forums wrote many words on many subjects and I endured the gamut possible responses over time. My all time favorite is still Plonk as that one word continues to tickle my funny bone. If a couple of thousand Hunkybill posts survive on some hard drive in some data center for a few more years that is one thing, but I was pretty sure I wanted to create something a little more structered and formal.</p>

<h3 id="acknowledgements">Acknowledgements</h3>

<p>First an foremost I want to say a big thank you to Shopify for supporting this effort through the Shopify fund. Over the years I expended energy and time recommending Shopify to all comers but at the same time, I can see that I was also critical and not always a perfect gentleman in my writing. Instead of ignoring me and my pitch however, Shopify chose to sweep aside some of the lower points from the past. Taking the high road and for that I am grateful.</p>

<p>To all the developers and designers that I have interacted with I owe a hearty thanks to as well. Some fine people have come and gone from the Shopify community over the years and I do respect the fact that a lot of their contributions remain useful and just as valid today as they were five years ago. It is very inspiring to have witnessed how one Caroline Schnapp jumped into the Shopify community, starting off with some simple scripting work to make shops better until ultimately she was so valuable to Shopify they hired her! My thanks to Caroline for sharing with me her wisdom about how Shopify really works and for always correcting me when my forum posts are clearly sour or plain wrong. I mean no harm to anyone and I am trying hard to avoid controversy these days.</p>

<p>I also with to thank Tobi from Shopify for his numerous great contributions to open source software like Liquid and Delayed Job. Programmers always learn by studying what other successful programmers have done and I must admit that I have learned many good things from his code. Thanks to Jesse Storimer for sharing his eBook tools with me and his code. His original Shopify API Sinatra application was the inspiration that moved me to develop an App for myself and today I have over 500 installed Apps all based of off Sinatra running well in the cloud thanks to Heroku! The best developer friendly cloud platform has to be Heroku. Thanks also to Cody, Edward, Joey and Harley for the hospitality when I trucked on down the 417 to Ottawa for a visit to the new office. Very swell place to work and I am sure the entire gang that works there have one of the better workplaces in all of Canada to go to on a daily basis.</p>

<p>Thanks to my wife and kids for putting up with a guy who likes to sit in the corner all day and poke away at a keyboard instead of doing something heroic like flying space shuttles or putting out forest fires or saving baby seals from being clubbed. I try to be exciting for you but I just can&#x2019;t seem to find the right chords.</p>

<h3 id="who-is-this-ebook-for">Who is this eBook For?</h3>

<p>Everyone that is interested in Shopify&#x2026;</p>

<p>Why?</p>

<p>If you know nothing about Shopify, this book will provide some information about how it all works. Perhaps enough to inspire someone to go the next step and do some real research.</p>

<p>If you know a little something about Shopify, this book will probably teach you at least one thing you probably did not know.</p>

<p>If you want to develop Apps for Shopify, or build a theme for someone, this book may shed some light on the particulars of doing that.</p>

<h3 id="what-is-assumed-by-the-author">What is Assumed by the Author</h3>

<p>Nothing. Assumptions are almost always wrong. This is no written attempt to coddle anyone on the path to mastering some specific aspect of Shopify. This book is <em>not</em> a &#x201C;Learn Shopify in 7 minutes, 7 hours, or 7 days&#x201D; recipe book. There is no attempt to put into words any of the magic spells, incantations or dangerous chemistry that goes into the workaday world of a professional Shopify coder.</p>

<h3 id="about-the-author">About the Author</h3>

<p>My engineering career started professionally in 1990 at about the same the World Wide Web was invented with the introduction of HTTP protocol for the Internet. Before the use of HTTP was common the Internet was mainly used to exchange email (using SMTP), to post messages and have discussions on Usenet (using NNTP) or transferring binary and text files between clients and servers (using FTP). Archie, Veronica and Gopher were other interesting choices to use for searching documents. Once the Internet concept jumped across the early adopter chasm to be embraced by the dotcom businesses and general population, a flurry of changes ensued. Nortel had ramped up to make the Internet as fast and capable as is it today (and ironically crashed in the resulting process) and throngs of business people sitting on the sidelines with few clues about what to do with this vast network poured money into the foundations of what are today some of the most valuable business properties in the world.</p>

<p>1998 was the year I transitioned my software development focus from R&amp;D C and C++ development to Internet Computing. I recognized that one could craft very efficient programs with much less code using dynamic scripting languages, like Ruby, Python and PHP. If it took 25 lines of Java or C++ to put a button on the screen, Ruby or Tcl/Tk did it in one line. I was hooked on that concept.</p>

<p>The early commercial Internet was all about established software titans showing off their chops. Coding for the web involved Microsoft ASP, Visual Studio and SQL Server to deliver web applications running on hugely energy inefficient Compaq Proliant servers. Other quirky technologies like Cold Fusion were often used too. Many friends and collegues have done what I have and hung out a shingle as an Internet computing engineer. Need a web enabled CRM? I can write you one. Need to manage your freight forwarding logistics company on the web? I can make you a web app for that. Need a website to sell flowers online? I can make you one. Need to send 50,000 emails to your world-wide employees? Got that covered. You have to interface to an EDI system with an AS/400 legacy database and a transactional web site? Let&#x2019;s do it. Ariba XML catalog to a SMB web site with an XML catalog of business pens and office equipment? Sure why not.</p>

<p>In the early years of running your own business as a software engineering consultant or freelance programmer you, like me, will inevitably experience the pain of working capital shortages. You&#x2019;ll collect a cadre of loyal clients with small or tiny budgets. You cannot easily sell them anything from Microsoft, Oracle or most other enterprise technology companies. Try presenting a license acquisition cost of $22,000 for a database server for your SMB client. The world of proprietary and expensive software pushed me to drop all that and adopt Open Source Software as my toolkit. I started developing using Linux as my operating system, PHP as my server-side scripting language, and PostgreSQL as my database.</p>

<p>Ignoring Perl as a web app scripting language and adopting the new kid on the block PHP meant building out a CMS was best done with Drupal and E-Commerce for the masses with OSCommerce. There was very little Ruby or Python code for these endeavors so I hunkered down to try and fill my toolbox with the best tools that did not totally suck. Yahoo came out with their brilliant YUI framework and I jumped on that immediately for the nice documentation and functionalities it provided. Soon after a software developer named Jack Slocum came along and decided to extend YUI into his own vision of a framework. He called his version YUI-ext and quickly attracted a small but loyal following. His vision was to provide Grids (like excel), and Trees (like Windows explorer or Mac OS Finder), and dialog boxes, and toolbars and most of the widgets that we take for granted today but that were rare indeed back then. Eventually that code matured into it&#x2019;s own product called ExtJS that today is perhaps better known as Sencha. Shopify was born at about this period of time in my timeline. Just as Ruby on Rails was becoming the new kid on the block.</p>

<p>PHP and Javascript were constantly evolving as were web browsers. As Microsoft oddly chose to stagnate with their now infamously bad IE web browser, Mozilla, Safari and Opera continued to extend web browser capabilities enough so that we could see realized the vision of web applications with enough sophistication to justify comparing them to native applications. Tools like Firebug and the Firefox browser, combined with Ajax (ironically a huge thanks to Microsoft for asynchronous Javascript) and the Ruby language offering introspection into a running Web App, developers now had something really hot to work with.</p>

<h3 id="finding-shopify-what-a-relief">Finding Shopify, What a Relief!</h3>

<p>Shopify was being developed and released as a Beta service. I signed up as soon as the Beta was available, knowing I would be able to offer e-commerce to my clients, without having to hack PHP OSCommerce again. If you have never examined OSCommerce code, you are somewhat lucky. It was at best a spaghetti western in terms of code. Plus Shopify offered a hosted service, eliminating worries about security, backups and system administration tasks. Having to maintain my own Linux and Windows servers in a co-location facility over many years provided me with ample opportunities to freak out with the responsibilities of system administration tasks. How to SSH tunnel between boxes? How to best freak out when hard drives failed? How can RAID can be a source of mirror images of garbage? How come hackers keep trying for years to break into my puny systems? How lousy is it to have to patch/upgrade services like Apache, PHP, Postfix, etc? Answer! Very much a lousy thing, at least for me. There is nothing like finding out a client&#x2019;s SSL certificate has expired, and I cannot exchange it for a new one without the password for the old one that is long forgotten and lost due to neglect. There is nothing quite like finding out the database has been failing to record certain entries for a few weeks due to a memory corruption bug.</p>

<p>Shopify to the rescue! Hosted E-Commerce! No more headaches! Simple templating with Liquid, ability to do any Javascript I want! That is the pattern that works for me. Should work for almost anyone.</p>

</div>
    <div class="chapter"><h2 id="the-shopify-platform">The Shopify Platform</h2>

<p>Since it&#x2019;s release to the public as a hosted e-commerce platform, Shopify has evolved through the adoption of new functionalities, the introduction of new features, as well as the refinement of the interface presented to Shop owners. As much as we all know competition drives companies to improve their products and services, in the niche domain of hosted e-commerce there are enough platforms to choose from that the decision to use one does require some careful study, thought and analysis. My experience over the years as a Shopify developer has informed me on how best to use the platform and when not to shut the door on possibilities.</p>

<h3 id="shop-administration">Shop Administration</h3>

<p>One of the most important aspects of setting up and managing a shop for online sales has to be the user interface to inventory, sales and all the many aspects that make the shop function live. The original Shopify provided some basic templates to work off of, and the support for setting up an inventory of products and collections. Initially there was a limited amount of functionality but it was certainly possible to open up a shop quickly that looked pretty decent. As the user base expanded to hundreds and then thousands of users, the administrative interface became the focus of much attention. Every little button or link click became an issue, and soon there was a lot of public discussion and scrutiny on how it all worked. There has always been a team dedicated to improving the administration interface and so today it functions as an example of well-thought out user interface design that relies on incremental change as opposed to radical make-overs. Considering the backlash a lot of web applications generate by changing the look and feel of interfaces, I think Shopify has done a great job of delivering improvements while at the same time relying on a consistent delivery of services. As an example, the early version of tags was a text based interface. Adding or removing tags was not awkward but it was also not really clear how they worked to improve a shop. By providing some guidance on how tags can be used with collections and the idea of filtering inventory, they became a much more useful part of administration. Today the tags are managed with a nice interface of clickable pills.</p>

<h3 id="liquid-templating">Liquid Templating</h3>

<p>As web application developers we have been treated over the years to numerous patterns and styles for delivering the HTML that makes up the <em>look</em> of our application. The first platforms to gain popularity were only capable of rendering results through a combination of spaghetti code. Mixing scripting code with output. PHP was and still is one of the best examples of this pattern where you can be sure developers will render a list, a form or some other elements directly with their PHP constructs. The problem with this tangled mess is that it keeps designers and integrators handicapped as they have to decipher scriptuing code while trying to add their HTML, CSS and Javascript flair. Some time passed and their was progress in separating the two camps. The next stage was to introduce templating to web applications. A template would render the look, and scripting would pump data to the templates. That is a fine pattern for systems where the end user is also the owner of the data.</p>

<p>With a hosted platform like Shopify there is simply no chance that a shop can have access to the back end database due to security, and the almost certain probability that a shop would manage to destroy valuable data with a single erroneous command. Hence the need for a templating system that could not only provide secure and non-destructive access the data of a shop, but to do that while providing some sophistication in terms of rendering. The resulting project created by Tobias Luttke was Liquid, an open-source templating language that is the real star of the Shopify platform. Liquid is really interesting in that it provides access to data without requiring users to have secret database passwords, or even the ability to create and run database queries. Liquid provides common programming idioms like looping over sets of data, making conditional branches to do one thing or another, and also has been setup with Shopify to provide a large set of very useful filters that can be applied to data.</p>

<p>The process of how Shopify uses Liquid is sometimes missed by clients, so I explain it this way. Shopify receives a request from somewhere on the Internet to render a shop at someshop.myshopify.com. Shopify locates that shop, and grabs the theme.liquid file specified by the shop. Going through the theme code, line by line, a series of assets get pulled into the theme that are usually the cascading style sheets (CSS) and Javascript needed by the shop. Each theme has to specify the content of the current request which could be the homepage, a blog, a collection or the cart. Shopify determines the correct liquid theme file to pull in and adds it to the theme. Finally, a theme can specify snippets of Liquid code to include in the theme. Sometimes it is beneficial to take special aspects of a shop like a front page carousel showing off products and keeping all that code together in a snippet. That way, it can be re-used on other parts of the site easier by simply including the snippet in the theme liquid file that needs the carousel. Once all of the code is assembled, the Shopify platform converts all the Liquid templating into HTML that gets injected into the theme. Since a theme is really just HTML and Liquid, once the Liquid is converted into HTML there is a complete HTML page that can be delivered to the original person that requested the page.</p>

<p>The implication here for developers to note is that they cannot inject code into Liquid. You cannot use Javascript to alter Liquid for example. Instead, you have to recognize that Liquid is going to completely render and provide the HTML DOM that is crucial to client side scripting. Shopify provides some excellent opportunities to take advantage of this Liquid rendering stage with themes. Any settings that a theme provides are really just Liquid code that gets rendered when needed. One example of where this comes in handy is in the style sheets for a site. If someone wants to make their text bold and red instead of italic and blue, and there are theme settings for those options, the user can make the change using the Shopify Theme Settings link and not have to touch the theme code itself. The theme settings are Liquid, hence when a request come in, Shopify creates the css to deliver to the browser substituting bold and red for the text. There is a huge amount of creativity that this kind of system encourages and at the same time, it keeps shop owners and developers honest in that they cannot break their shop or other shops without really trying hard. For example, if you write totally illegal and bad Liquid Shopify will usually flag the error and not allow you to save the erroneous code. That is one level of safeguard. Since Shopify is also all about speed, any Liquid that has been compiled into HTML will usually be aggressively cached meaning if 5, 10 or even 100 people all ask for the same shop at the same time, they will all get the same copy of the HTML in their browser, Shopify will not be compiling the Liquid 5, 10 or 100 times. This is why it is important as developers to write efficient Liquid too. It is very easy to setup loops within loops within loops to try and provide a clever shopping experience, but when analysed with an algorithmic eye, sometimes these Liquid constructs jump out as completely inefficient. Nonetheless, Shopify will not usually interfere with how people use Liquid on the platform.</p>
<div class="figure">
<img alt="Possible Distributions of Shops and Their Uses of the Shopify Platform" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/TypesOfShops2.png" /></div>
<h3 id="javascript-api">Javascript API</h3>

<p>There was time when Javascript was limited to working strictly on the HTML DOM as it was rendered in the browser. Web applications could use HTTP GET and POST to read HTML from servers and to send forms for processing. Every submit button or link click resulted in a whole new processed web page being sent to the browser. Microsoft provided Asynchronous HTTP calls that came to be widely known as Ajax. Still nothing more than an HTTP POST or GET, Ajax did allow a client to send a small amount of data to a server or service, and then listen for the reply which could come later using a callback. This pattern radically changed the web since it meant you could just replace a small part of a web site with new code and not the entire page. Shopify embraces this technology now with the Javascript API. Any Shopify site can include Javascript that sends requests to their Shop and then waits for the response. For example, with the Javascript API I can load a cart with 16 products, change the quantity of each one in the cart, and then I ask for the contents of the cart once it is all loaded up to see what is the total price of items in the cart. All from anywhere on the site, including the homepage, while on a blog article or while cruising through a collection of items for sale. I can set a cart note from the homepage. I can delete a product in the cart from the product page. There is a whole world of very useful scripting that can be done with basic Javascript and the Javascript API. One of the first things I ever do to a shop I work on is to add my own little factory of utility functions, as well as the Javscript API. Even if a client is reluctant to offer fancy features to their shop, I need this code running to just get the basic development done. I cannot imagine working on a shop without being able to query the cart from my Javascript developer console. It truly is a crucial and wonderful aspect of developing shops.</p>

<p>There are four interesting Javascript files apart from the Shopify Javascript API that are available from Shopify to help make shops more sophisticated in the presentation of products. The most common is the <em>option selector</em> code available for shops that want to present products with various options like colour, size or material. The natural HTML element to use when presenting options is the <em>select</em> element. The use of options can increase the number of variants dramatically. A product that has three colours, four sizes and six different materials generates seventy-two variants! Shopify allows up to one hundred variants per product. The Javascript option selector code presents each option in it&#x2019;s own select element making it pretty easy for a shopper to select from the colours, sizes and materials to quickly find the variant they want to purchase.</p>

<p>For shops that take advantage of this option selector code and that let Shopify control inventory quantities there is a common issue where shoppers can select variants that are out of stock. In many cases shops may have sparse inventory meaning a lot of the options are presenting the sold out or unavailable text to shoppers. To avoid this Shopify offers another small Javascript file that will hide any options that are sold out allowing a shop to present only variants that are actually in stock. This is a very handy extension to the usual option selector code.</p>

<p>Another handy Javascript pattern from Shopify gives a shop the ability to present estimated shipping costs in the cart where they can be seen before checkout. The code presents a form to collect the general location for delivery in the form of a zip or postal code, and then uses the Shopify API to query the shipping services setup for the shop. For shops that offer expensive small items eg: jewelery, or ones that offer relatively cheap large items eg: stuffed animals, shipping can be a real problem to accommodate well. Freight is calculated on dimensional packaging and not necessarily weight. The Shopify shipping estimator ca really help shoppers see the true price of a purchase before any shocks occur when checking out and that can really help converting carts into sales.</p>

<p>A final useful Javascript code package available from Shopify is called the Customizr. If you have to collect a name for engraving on a glass baby bottle you sell, or to collect the initials to be monogrammed on a leather handbag, or any other number of customization tasks, it is almost certain you will have to collect this information using cart attributes. Cart attributes are passed right through checkout with the order and are available in the <em>Order Notes</em> section of the Shop&#x2019;s Orders tab when looking at an order&#x2019;s details. Attrributes that are collected in this way can be rendered in the order confirmation email to inform the client of the detail&#x2019;s of their purchase. Further excellent opportunities exist to help an online shop run in that orders can be sent to a custom App using WebHooks, ensuring a custom App can perform additional business logic based on the attributes present in an order. I describe this in more detail when talking of App customization. It should not be a surprise that using cart attributes to collect custom information is complex. Collecting data at the product or collection presentation level, recognizing previous customization efforts when switching to the cart and then back to the same product pages is challenging. Add to that the fact that shopper&#x2019;s will often want more than one of something, and the code has to now manage quantity as well. When shoppers remove an item from their cart, any corresponding cart attributes have to be removed as well. Since checkout is separate from the shop, if a shopper starts checkout and then decides to revisit the shop, all the customization has to be available. That means any code has to be rock solid and demonstrate a mastery of browser features like localStorage, cookies, and the ability to serialize data as JSON. Ultimately a shop owner has to be able to know which glass baby bottle gets etched with the name &#x201C;Eddy&#x201D; and which handbag gets the initials &#x201C;G.B.H&#x201D; or &#x201C;S.N.F.U&#x201D;. Customizr can go a long way to making this possible without a major investment in custom Javascript code.</p>

<h3 id="shopify-api">Shopify API</h3>

<p>Along with the Javascript API that offers up client side access to the cart and functionality like estimated shipping rates and separated options, there is the Shopify API. Whenever I have access to a shop I can use the Apps tab to select the Manage Apps option. With this I can create a private App that provides an API access token and password that allow API access to a shop. Using the Shopify API command line interface (CLI) that is described elsewhere in this book, I can quickly open up a terminal console and query a shop using the API. Since I like Ruby scripting, with just a few lines of code I can alter every product in a shop to have a special Product Type or Vendor. To me this beats downloading the entire inventory, fixed those values in the resulting CSV and then re-uploading the products.</p>

<p>Since I joined the Shopify Partner program, when I login to the partner App with my account, I am able to create Apps too. An App has a name, and when created it generates an API token, a shared secret and can thus be installed in a Shop. An App can then issue HTTP requests with either XML or JSON payloads against a Shop where the App has been installed. This means the Shopify API can be used by an external App to provide additional functionality a shop does not come with by default. An App can be created to add features to just one shop and no others, or an App can be created that can be installed in thousands of shops, offering unique functionality to all of them at the same time. By hosting an App in the cloud it can be fairly easy to ensure that the App itself has enough resources to handle hundreds or thousands of installations. Of course some developers prefer to run their own servers in colocation facilities and that works equally well.</p>

<p>The API is well described by Shopify so I am not going to duplicate those efforts here. Instead I am going to describe how the Shopify API and Apps can be leveraged by shops that require just a little bit extra to function. One example that I found justifies the use of a custom App is a Shop that sells Art. Art is a unique domain with some specific quirks that make it interesting. A painting is for sale, as a product and so the usual Shopify application will be fine. Paintings can be organized into collections just as they might be in a gallery or museum. The challenge is that a painting has a history. It has been toured around other galleries and museums. Each exhibition adds some value to the story the painting has to tell. That history is best captured as meta data resources attached to the painting, not something you stuff inside the paintings description. Using the API it is easy to capture this meta data and thus manage paintings for sale so that they render their own history without it being tightly coupled to the painting&#x2019;s description. A painting is also very much belonging to the Artist that created the painting. Shopify does not have much support for a construct like an Artist that has a name, a date of birth, a country of origin and a biography. Using an App and the API it is easy enough to capture Artists as resources and to describe them.</p>

<p>Now to make a gallery shop easier to manage we want these extra resources to be available to the designer so they can be presented in the shop&#x2019;s theme without too much fuss. Shopify offers up an App Proxy that stands in as a special page in a shop. A gallery can thus point clients to this special page where the shop will render custom resources. As a quick example, using the Artist concept, when visiting the special page there is a special Liquid template installed by the App that contains some custom Liquid tags.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"artist"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"artist-name"</span><span class="nt">&gt;</span>{{ artist.name }}<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ artist.country }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ artist.biography }}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
</div>
<p>When a shopper visits this special page there is a connection to the App that provides the App with the artist&#x2019;s identification. For example, the artist&#x2019;s name. The App also knows there exists a special Liquid template installed in the shop, so it reads that template since it could&#x2019;ve been altered by the shop&#x2019;s theme designer. The App Proxy searches the App for the artist&#x2019;s information and once found, it replaces the liquid tags it knows with the appropriate information. With that step completed, the App then sends back the Liquid template for processing by Shopify. Shoppers now see custom artist information like a name, country and biography, along with a collection of the artist&#x2019;s paintings, rendered from a standard Shopify Collection.</p>

<p>The combination of the Shopify API, Apps and App Proxy provide developers with an amazing degree of latitude to make shops that go far beyond the basics of selling snowboards or t-shirts. Constant development and improvement to these platform features ensure the domain can only be more interesting and challenging as time passes.</p>

<h3 id="theme-store">Theme Store</h3>

<p>In the early days of Shopify there were just a handful of basic themes available. Designers could download these themes as zip files and tinker with the HTML, Javascript, CSS and Liquid constructs using a text editor. There were only three ways to see the effect of editing a theme back then. One was to edit the theme, zip compress the changes and upload to the live theme. A second was to edit the theme inside the Shopify administration screen. Prior to decent text area editing this was not a great option. Thirdly Shopify provided a small self-contained web application called Vision where early adopters of Shopify could edit their themes. Vision provided a limited inventory and enough templates to show of basic theme changes. Quickly this approach was panned as it failed to keep up with progress in changs to live Shops, and most people had trouble wrapping their heads around theme changes that always showed snowboards for sale. The inventory of products and pages and collections could be hacked since it was just a YAML file representing a live inventory, but this was tedious and prone to error. I think most people were happy when Shopify abandoned Vision as moved to the superior model of providing test shops to work off of. Any Shopify Partner can create a test shop and load a theme into it to start working. Since you can also load an inventory into a test shop, they provide a great way to develop a theme without risk to borking a live shop. Along with test shops came a Theme store where you can download themes that are free and themes that cost money but come with nice features that might otherwise cost mooney to develop.</p>

<p>For talented web designers that understand the nuances of cross-browser issues with respect to Javascript and Cascading Style Sheets as well as Liquid scripting, getting a theme into the Theme store is a great way to become more popular, well-known and to make some money. It is probable that the first thing a new Shopify shop owner will invest in is the look of their shop, hence a visit to the Theme store.</p>

<h3 id="app-store">App Store</h3>

<p>Like the Theme store, when Shopify released the API and paved the way for Apps to be developed and integrated into shops, they created the App store too. The Shopify mantra of keeping the core Shopify code simple and free of complexity has ensured there is a need for Apps that can deliver the much needed extras e-commerce shops demand. There are slightly less then two hundred Apps that can installed in a shop as of early 2012 and this number is sure to continue climbing as shops demand more sophistication.</p>

<p>For developers the App store offers the audience of all the shop owners and anyone researching the Shopify platform is also sure to take a tour of available Apps to see if Shopify is indeed suitable as their platform of choice. To make the financial aspect of developing Apps and providing them to shops easier on developers Shopify makes their billing API available to developers. In exchange for 20% of any App costs, be they one-time charges or recurring charges, Shopify collects the money for developers and deposits it in the App Partner account. I find this handy as it remains difficult to charge recurring or subscription fees in Canada since there is no access to services like Stripe in the United States. Other countries may have easier online banking available.</p>

<p>It is also possible to setup one-time charges when you want to provide extra support services to clients. The billing API is just enough to help developers get their Apps in front of the entire Shopify subscriber base without incurring major administrative headaches.</p>

<h3 id="shopify-experts">Shopify Experts</h3>

<p>As the years have passed and Shopify has grown and attracted many more clients, the number of shops includes some very high profile clients. They are interested in all the good features the platform offers but they also want to know that they can have their special needs taken care of without having to launch a complex search for talent.</p>

<p>The Experts application was launched to showcase talent working on the Shopify platform. Designers can join and they get a chance to show off their themes and design work. When a custom theme is a must, it is important to choose a designer that understands how Liquid works and how to deliver a well conceived theme by leveraging the Shopify platform properly.</p>

<p>For code developers like me, the Experts showcase is a way to inform people that need custom App scripting or custom Javascript that they have resources to contact. Combining deep knowledge of how the Shopify platform works from the theme templates, through the Javascript API and the Shopify API it is certainly a domain with enough complexity to attract devlopers that are experts at cloud computing, user interface coding, and a host of other skills.</p>

<p>There are also slots in the Experts application for accountants and photographers as these skills are also very much in demand by shops that have the present the best possible look for their products and services, and to be able to do accurate reports on just what is flowing through their online universe.</p>

</div>
    <div class="chapter"><h2 id="shopify-developer-tools">Shopify Developer Tools</h2>

<p>As an engineer and software developer with some experience, over the years I have coded for many processors in many languages. From Z-80 Assembly language on the TRS-80&#x2019;s Zilog Z-80 8-bit CPU, through 6502, 6800 and 68000 chips, to Amiga 500, Sun Workstation C++ and then to PHP, Ruby and Javascript on homebrew Pentiums, the tools coders use day to day have not varied much. These days coding complex web applications on a laptop in a cafe is normal and having great code environments and tools is a welcome change. For those that want to try developing a Shopify App or build out a nice theme for a shop all you need is an inexpensive laptop with wireless Internet and the desire to learn the details of Internet computing.</p>

<h3 id="the-text-editor">The Text Editor</h3>

<p>Vim, Emacs, TextMate, UltraEdit, Sublime Text 2, Coda, Eclipse, Visual Studio, Notepad and the list goes on. Choosing a text editor is a very personal choice and as I cannot touch type I can offer no wisdom of choice. I love Sublime Text 2 though. I merely get by with my horrid typing skills in the sense that I type at about the same speed as I think. Maybe I think slow and my typing matches that speed? I am not sure. I have never been tested. I am amazed when I see people writing code as they stare out the window at the coffee shop and I wish I could do that too. If I was hiring a coder I would judge their typing skills in the sense that if they cannot really type, then they cannot be a real coder. I am guessing that puts me pretty close to the bread line! At a recent Hadoop Hackathon I attended, the local administrative guru literally flew faster through command line and vim commands then I have ever witnessed before or since. Simply amazing the capacity some people have for that. A text editor has to <em>syntax highlight</em> Ruby, Javascript, Liquid, Haml and Sass and other languages, has to <em>autosave</em> all my code changes whenever I stop coding and switch tasks and it&#x2019;s pretty much a sure thing it will need to be able to accept scripts to speed up development.</p>

<h3 id="the-web-browser">The Web Browser</h3>

<p>Obviously every developer needs a good web browser to work with, one that provides decent tools for examining the results of Shopify theme tweaks or interactions with web applications. All the major browsers these days are suitable however each brings certain quirks to the table. My favorite is currently Chrome. The developer tools are decent. Safari and Firefox offer decent alternatives to Chrome.</p>

<h3 id="versioning-your-work">Versioning Your Work</h3>

<p>Shopify will version templates as you change them. This built-in versioning system is not terribly useful for a team and certainly is not something you want to rely on for your only theme backup choice. I highly suggest learning a distributed version control system (DVCS) like <em>git</em>. Becoming even a beginner with the <em>git</em> system is a basic skill every developer should have that will payoff in spades. With git you can version <em>everything you work on</em>. Every line of code, every proposal, even binary work like images and assets that you might not ordinarily think of as something that should be under version control. Plus, almost all the coolest open source projects are available using git and there is a serious community of developers all working and sharing code with git.</p>

<h3 id="dropbox">Dropbox</h3>

<p>Dropbox is great way to cheaply share files and serves well for a workflow between small teams and clients. You can toss files into Dropbox and speed communications along and it beats managing large attachments in email. It has reasonable security most of the time too.</p>

<h3 id="skitch">Skitch</h3>

<p>Often I will take a screenshot and mark it up with Skitch and then share the resulting image with a client. It is fun to log in to your online accounting package, dig out the invoice you sent to the client 2 months ago, Skitch the timestamped entry showing they logged in and acknowledged the invoice, and fire that image off to them. The mumbled excuses and apologies from their embarassment as you call them out for skipping their obligatory payment for services rendered is a little salve or tonic along the way. Remarkably some clients are oblivious to their obligations and these are the ones to watch out for. The ones that agree to your best estimates to get them most of the way there, and when you finally deliver they come up with a new list of things they insist were there all along and agreed to. Best to keep notes, printed and dates copies of agreements and to watch out for constantly changing requests.</p>

<h3 id="instant-messaging">Instant Messaging</h3>

<p>You have to use Skype, Adium, Pidgin, iChat or some other service to work with clients. Email does not cut it when you want to really rip through a work session with a client and bounce thoughts and ideas of off them. Screen sharing is one of the quickest ways to teach a client about what your App does, what the shiny buttons they can press do, and the easily overlooked luxuries you&#x2019;ve provided them just because you can. Writing a manual for an App is fine too but that takes many hours and in the end, the second you finish that manual it is full of errors or at least erroneous screen shots, descriptions and information as web apps can evolve in near real-time, even after they have been &#x201C;delivered&#x201D;. I often re-factor my code just because I feel like it (and certainly not because v0.9 is embarrassing, although it might be).</p>

<h3 id="terminal-mode-or-command-line-thinking">Terminal Mode or Command-Line Thinking</h3>

<p>To make working on Shopify themes easier, Shopify has a command-line (CLI) utility available that can be installed on any computer with the Ruby scripting language installed on it. The utility provides a few basic commands that allow you to easily download an entire shop for editing. You can then immediately check the entire shop codebase into a version control system like git. The next step is to tell the computer to watch for any changes in the theme files. If a change is detected like adding a collection title to a template or a for loop is added to render some navigation links in a menu, you want those changes automatically sent to the shop. That way, you can simply refresh your browser and see the changes you just made. Even better, there is a development tool called Live Reload that will auto-refresh your browser whenever changes are detected to the code that is currently being rendered in the browser, meaning you can edit your Shopify theme or App, and simply switch focus to your browser to see the results without doing much more than a single keystroke combination. As a developer learning to use the command line with skill and knowing how the operating system utilities help is essential.</p>

<h3 id="localhost-development-on-a-laptop-desktop-or-other-devices">Localhost Development on a Laptop, Desktop or Other Devices</h3>

<p>With text editing, version control, and a web browser, a developer is ready to tackle almost any kind of Shopify project. To develop an application that can be hooked up to a Shopify shop it will be imperative to be able to develop the application on your local machine. In the early days of web application development one had to ensure there was a web server like Apache available in addition to scripting languages like Ruby, Python and PHP. That extra level of hassle we do without since Ruby provides several extremely fast web servers that make local development a breeze. A great example is the <em>thin</em> webserver by Marc-Andre Courneyer. Other options exist like Pow from 37Signals, WebBrick, Mongrel, Nginx, etc. Testing a script out on a new concept or idea or running an entire App should not tied to a server on the Internet. Being able to develop localhost when offline is crucial.</p>

<h3 id="pre-compiled-css">Pre-Compiled CSS</h3>

<p>A final tool for the Shopify developer that I think deserves more attention is the use of compiled CSS through the use of Less or Sass. Less can be compiled with Javascript and Sass is compiled with Ruby. The advantages are somewhat spectacular in my opinion. You can build a complex Shopify theme using these tools and gain a lot of very important flexibility. A client can change one value in their shop and the change propagates throughout the CSS easily when you use Less or Sass. Working stylesheets by hand is clearly the least efficient methodology especially when a developer does have a good understanding of how CSS works.</p>

</div>
    <div class="chapter"><h2 id="common-questions">Common Questions</h2>

<p>There are plenty of reasons to choose a <em>hosted</em> platform like Shopify as the responsibility for the necessary implementation details of ensuring your shop&#x2019;s site is reachable by the public is purely Shopify&#x2019;s responsibility. By offering a platform that provides most of the basic features needed to run an e-commerce website Shopify has created a thriving community of shops that sells soup to nuts. It can be comforting to know that when an issue arises with respect to how to configure a shop that there are other people that have faced the same issue before and likely solved it.</p>

<h3 id="how-to-capture-that-extra-information">How to Capture that Extra Information</h3>

<p>One of the earliest and still most common questions is about how to capture custom information for products. There are thousands of shops that need to collect custom information. Glass baby bottles etched with a monogram, handbags with initials stitched into the leather, silver pendant jewelry with the name of the family dog or the newest twins on the block, the presentation of a form to collect this information is seemingly a source of endless discussion.</p>

<p>With the introduction of cart attributes it became possible but not necessarily simple to pass extra data through checkout with the order. The cart attributes are a simple key:value pair where a key is used to refer to some value. An order can have as many of these attributes to fully define needed product customization for an order. A typical key might be the identification number of a product. The value that can be stored with the key is usually a string of text. The following code present a simple key and value.</p>
<div class="highlight"><pre><span class="nx">attribute</span><span class="p">[</span><span class="s1">'I_am_a_key'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"welcome to outer space astronaut!"</span>

<span class="nx">attribute</span><span class="p">[</span><span class="mi">12345678</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"David Bowie"</span>

<span class="nx">attribute</span><span class="p">[</span><span class="mi">44556677</span><span class="p">]</span> <span class="o">=</span> <span class="err">'</span><span class="p">[{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"qbf"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"jtld"</span><span class="p">},</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"lh"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"lnot"</span><span class="p">}]</span>
</pre>
</div>
<p>Those are three examples of setting a key to a value. Using Javascript it is possible to experiment by setting a cart attribute and then checking that it was set correctly. Web browsers all provide Javascript and Javascript represents data and objects in a format called JSON. One excellent fact about this is that JSON can be stored as a text string and that means we can create complex data structures and save them as attributes! The third example I present shows this. The cart attribute for ID 44556677 has been assigned a string of JSON. This is extremely handy in a web application like Shopify. That value could be read as &#x201C;There are TWO 44556677 variants in the cart, one is named <em>qbf</em> and the other <em>jtld</em>&#x201D;. When rendering the cart to shoppers, it&#x2019;s possible to show these values in the appropriate line items along with the variants. The checked out order will display the same keys and values.</p>
<div class="highlight"><pre><span class="mi">44556677</span><span class="o">:</span> <span class="err">'</span><span class="p">[{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"qbf"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"jtld"</span><span class="p">},</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"lh"</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">"lneg"</span><span class="p">}]</span>
</pre>
</div>
<p>The previous script presented is a little confusing perhaps and some shop keepers might balk at having the customization information collected looking like that. It is possible to deal with this issue by approaching the issue with more sophistication. Instead of directly storing the customization data in cart attributes, they could be stored in a cookie, or in the web browsers built-in localStorage. During the creation and subsequent editing of a specific shopping session the custom code manages the customization information as JSON but before submitting the order to checkout the code translates the JSON to plain english that would be set as the values in the cart attributes. As an example, if my variant represented a Farm Animal, for $24.00, I could rewrite the attribute to be</p>
<div class="highlight"><pre><span class="nx">attribute</span><span class="p">[</span><span class="s2">"farm_animal"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Name: QBF, Action: JTLD, Name: LH, Action: LNOT"</span>
</pre>
</div>
<p>That is a little more readable and could be interpreted by the Shop owner with little difficulty.</p>

<p>One important aspect of customization that should be addressed is that flexibility like this comes with a certain cost. While it does imply that you collect extra information for a Product, you can lose certain Shopify functionality when you use it. For example, if you have the need to customize a product with four options, Shopify only has three. So you decide to collect the fourth option with a form field, and use the built-in options for the other three. When you make this choice, you lose the ability to keep track of inventory based on that fourth option. If that does not matter, then it is obviously not a problem. I often tell people that if price changes are involved, they have no choice but to use the built in options to customize variants. This costs them SKU&#x2019;s and there is a limit of up to 100 customized variants. A virtually unlimited amount of further customization is possible, but it should be applied to options that have no inherent cost or affect on inventory management.</p>

<h3 id="image-switching">Image Switching</h3>

<p>Shopify organizes a product by assigning it attributes like vendor, type and description. A product has no price per se but it does have variants, and each variant of which there has to be at least one has the price. A product also has images. If we think about this knowing just these facts it is clear that if we upload many images for a product then we may have many images uploaded for the product, but there is no connection to the variants!</p>

<p>If a shop is presenting a product that comes in five colours, or perhaps seven differing kinds of fabrics then it is likely they will want to change the main image presented to shopper to match the currently selected option. If I am looking at a t-shirt and I select the colour blue for it, I would expect the t-shirt to change to be blue. Some of my earliest customization jobs were all about providing this to shops. Wall Glamour in the UKlamour&#x201D;) is a simple example of this. When choosing any kind of wall stickers, you can click a colour palette and the main image changes to match.</p>

<p>The vexing issue has always been that if you have 20 variants and 20 images uploaded, how do you connect them together? Recently Shopify introduced <em>alt</em> tag editing for uploaded images allowing a simple bit of text to be saved with uploaded images. Not only is this good for SEO but it can be used as a rudimentary hook so that when variants are selected, the image alt tags can be searched for a match, and an image swap can occur. I have never had trouble with more sophisticated approaches involving naming the images according to a variant key like SKU or title and using regular expressions, but for novices the Shopify alt tag approach is pretty good. You sacrifice SEO results for images, but you gain nicer shop presentation when images match the selected variants.</p>

<p>One cool aspect of swapping images is that all the images are readily available from Liquid when you pass the product through the built-in Liquid filter <em>json</em>. Any Javascript code can thus grab any image and process it as needed. By that I mean you can tack on an <em>grande for the Grande size image, or</em>thumb or any other image size designation and have that image for use on the page. Once the Liquid phase of rendering a product is done it can be left to Javascript to support image swaps with nice effects like fades and other easing motions.</p>

<h3 id="jsonp">JSONP</h3>

<p>Most developers that have done any Javascript have probably done some asynchronous Javascript programming to. With Shopify being a hosted platform, all shops are known by their staked out subdomain name and the <em>myshopify.com</em> root domain. Even if I use the DNS to fool the world into thinking my shop is found at http://www.young-marble-giants.com it is still and forever http://no-eat-the-blue-mushrooms.myshopify.com for all intents and purposes. If I have a special question I have to ask of an App how can I do that? I could use an HTML <em>iframe</em> element I to embed a form in my shop, or I could use JSONP. That allows me to make a cross-domain Ajax request and so I can render the results of a question asked on the domain http://no-eat-the-blue-mushrooms.myshopify.com but answered by the domain http://veggie-chef.heroku.com. This can be quite useful and serves as a huge support mechanism on more than a couple of sites I have built out for clients. If I wanted to avoid JSONP and just use straight up Ajax I could always create a subdomain like http://fizzbuzz.young-marble-giants.com and therefore I would be operating on the same domain and Ajax would work.</p>

<h3 id="special-invites">Special Invites</h3>

<p>Before the App store and lockdown Apps like Gatekeeper were available, it was really difficult to open up a Shop and keep it locked down so that only choice guests could shop there. I was asked once to build out a Gatekeeper style solution just around christmas a few years ago. The nervous nelly NYC designer that contacted me was very concerned Shopify could not handle extreme traffic, and he was equally concerned that any App I built for him would crumble under intense load too. I brushed him off since all I knew was that there is no sense is worrying about something that has not happened and for all I knew, his shop would see 20 visits or maybe 200 or maybe even 2000 but all those numbers are small, so why worry.</p>

<p>I built an App that presented a simple form that captured a person&#x2019;s email address and a secret code. The code and the WWW address of the App was presented to all the people watching a popular TV show on D-Day. Each person that typed in the correct code had their email address sent to MailChimp and then the App unlocked the password protected Shopify site using the credentials only the App knew. Since the App was on a subdomain of the Shopify domain, the App could set the needed session cookie Shopify created and thus the TV shopper was seemlessly transferred into a locked shop without having to face the password screen. I paid little attention to this whole setup until D-Day around 3:00pm. I logged into the shop admin and was astonished to see close to 13,000 orders booked for that day alone and sales north of $750K. Considering the items for sale were made in China and cost a buck or two each, this was a real eye opener. I learned the lesson that accepting contracts like that without negotiating for a small % of sales is not great business. Both Shopify and my cloud based App never hiccuped during this event and that really gave me a lot of confidence in the platform.</p>

</div>
    <div class="chapter"><h2 id="and-youre-wondering-about-clients">And You&#x2019;re Wondering About Clients?</h2>

<p>It is a good thing to wonder about your clients. The amazing thing about hanging out your shingle as a Shopify developer is the sheer unbridled variety of clients you will meet. If you are like me and enjoy sticking pins in maps, working on Shopify will probably force you to buy a Costco sized box of pins for your world map. Like the Ham Radio operators of yesteryear, collecting shops from far off countries and cities to work on is neat. I still have no hits from Easter Island but I am holding out hope.</p>

<p>Before corporations knew about the Internet, when cocaine and limos still ran the music industry and newspapers and magazines actually made money, there was little or no online e-commerce. Amazon orders for books and cake decorating tools with next-day delivery to your door? Not a chance back then, a mere decade ago. As Nortel sacrificed itself on the alter of greed laying fiber p\ipes and high speed machines for the coming Internet goldrush age, e-commerce was just a pale shade of what it is today. Now, <em>everyone</em> wants in and Shopify is a handy platform for many young businesses to try.</p>

<p>Some clients understand that while Shopify does not try to offer everything to everybody, what it does offer is sufficient for most of their immediate needs. There are also plenty of clients that approach Shopify with notions of what they <em>think</em> they need and so when you tell them Shopify does not support their needs, they pop off like bottle rockets and rant. I enjoy these little conflicts. It gives me an opportunity to argue from both sides of the fence. Some of them make a good case and I feel bad that they cannot realistically use Shopify without sacrificing something fundamental. Internationalization is one of those issues. Many shops need to serve their public in more than one language and Shopify does not work in more than one language with the same shop. Even if a shop is presented with a deal on a second shop there is a lot of work in trying run two shops instead of just one.</p>

<p>Some other examples of very common rants I hear:</p>

<ul><li>Shopify can&#x2019;t do one page checkout, oh my god that sucks!</li>

<li>I can&#x2019;t pre-program the Discount Code! Gah! That&#x2019;s terrible!</li>

<li>I can&#x2019;t just change the price by 10% when they order 2 or more? What the hell is that?</li>
</ul><p>After six years or so, I am sure Shopify support staff are also pretty tired of hearing the same complaints. As time has passed the platform has not only grown and extended in capabilities but it has shown a certain amount of resilience too. Faced with the choice of trying to do much or just doing what it does do well, Shopify has embraced the idea of just doing what it does well.</p>

<h3 id="clients-respond-to-clear-explanations">Clients Respond to Clear Explanations</h3>

<p>One of my favorite ways of explaining to clients why they cannot have Shopify just change on a dime is the story about Javascript, the lingua franca of all web browsers. It was created by a programmer with lots of experience at developing languages in about 10 days. Today it is part of every smartphone, every iPad tablet and all desktop web browsers. For all it&#x2019;s flaws from day one it remains much the same today, a whole decade later. Turns out you cannot put the genie back in the bottle and so Shopify cannot undo the patterns laid down six years ago either. Software is probably mankind&#x2019;s most fiendishly difficult invention and so we have little choice but to go with what works for as long as possible. We do not want to tinker with a working formula. Right Coke? When they changed their formula they had their butts handed to them on a platter.</p>

<p>If a client complains about checkout, I think it is fair to ask them where they get their data supporting their case that one page checkouts convert better than multi-page checkouts. Are there enough Ph.D dissertations awarded that clearly show that as a certainty? Discount codes are another interesting trend these days. As Groupon and Living Social have demonstrated handing out coupons to people can be really good for increasing business. I am content to ignore discount coupons for the moment although I did come up a great App that makes my clients very happy. When reviewing an order where the client is not a happy camper I place a link on the order details screen that sends a nice apology letter to the client with a nice discount code attached. Works like a charm.</p>

<h3 id="i-want-variable-pricing">I Want Variable Pricing</h3>

<p>In Shopify, a product has no price. Only a product&#x2019;s variants have a price. If you set a price on a variant you cannot change it willy nilly at any point in a session. You cannot make it bigger or smaller. You may want to but you cannot do it. It often comes up that clients will want to bundle products together and if someone buys entire the bundle, it should be cheaper for the products. And yes I believe that, in fact I am on my knees looking up at the sky right now and I am believing that! The thing is Shopify does not work that way. If I bundle three products that cost $10 each together when they go in the cart they still cost $10 each. The bundle costs $30. It cannot be $25 just because. Some clients shake their heads at this. There are of course ways to sell bundles cheaper, but that involves actually making them separate products.</p>

<p>The <em>ideal client</em> will understand that e-commerce and opening a shop is a tough business. My ideal shopper is me. In my shoes I want to buy something off the Internet. I am prepared to part with my hard earned Paypal balance or even add to my Visa debt for what I need. I am willing to wait a week for it to arrive at my door. I start with the search engine. Does what I want even exist for sale? If it is for sale is there an online source for it in my country? It is amazing how Amazon messes this simple need up. I have credits at Amazon.com but I cannot use them with Amazon.ca. I want to buy something from Amazon but only Amazon.com sells what I want. I put it in my cart but at checkout they warn me I cannot buy what I want. No explanation just a No. So now I am browsing for Shopify or other small e-commerce retailers for what I want.</p>

<p>If I find what I want at a smaller shop than Amazon I still expect the buying process to be simple. I want that thing. Please send it to me now! Take my money. Thanks! The point is I like clients that are more concerned with their products being found in the first place than those worried about offering coupons.</p>

</div>
    <div class="chapter"><h2 id="shop-customizations">Shop Customizations</h2>

<p>I would like to briefly explain some Shopify customizations that have not only stood the test of time but that I think underline the flexibility of the Shopify platform.</p>

<p>One shop started up and met with some initial success. So much success that the shop owner was up against a wall with the Shopify administration Orders interface. He had one thousand orders that were all paid up and needed to be fulfilled. Those orders were from a short period of time under a week. He phoned me to inform me that the task of individually fulfilling these one thousand orders was stressing his wife out and that that in turn was stressing him out. You can use the Shopify API to inject a link into the Orders Overview screen so I told him that I could hook up an App that would respond to a click and fulfill all the selected orders. His wife was no doubt pleased to be relieved of the click-o-rama sessions.</p>

<p>Fulfilling orders in bulk taught me valuable lessons about using the Shopify API. An App has to stay within the limits that govern how many times you can use the API in a short amount of time. Shops can make 500 API calls in 300 seconds. If an App fulfilled 250 orders and then a second request came in moments later requesting 250 more orders be fulfilled followed shortly thereafter with another 250 orders the API limits would certainly be exceeded and the App would be blocked from using the API.</p>

<h3 id="using-delayed-jobs-to-manage-api-limits">Using Delayed Jobs to Manage API Limits</h3>

<p>Early attempts to work within the API limits resulted in using code that would sleep for 300 seconds when the API limit was reached. This turned out to be awkward for many reasons. I needed certainty that all operations completed without failure without the complexity of counting API calls. My solution was to setup a delayed job to process the fulfillments in the background. The delayed job is run by a worker process. Each API call to Shopify either succeeds or it does not. If it does not succeed because the API limits have been reached the delayed job spawns a new delayed job with the remaining work to do and it sets it to run 300 seconds in the future. Using this technique it is possible to process as many API calls as possible without API limit problems. It&#x2019;s a very elegant and robust system proven to work well by hundreds of thousands of successful API calls.</p>

<p>Once that task was completed a more interesting issue arose. The products sold are edible and they always get delivered on a Monday or Tuesday. When ordering the product clients wanted to order for more than one week. Shopify does not currently support a recurring order or subscription service so we had to put on our thinking caps. The solution was to provide a quantity field for the product in the cart for each week a person wanted the product. A person could order one, two or up to four weeks of the product and pay once for all deliveries. By recording the delivery dates, it is possible to know exactly how many products get delivered per week per person. Some people order 2 or more per week so this had an immediate positive impact on the bottom line. We even added a button providing 3 months worth of future dates. Watching a shop nail 15% or higher sales with tweaks like this is rewarding.</p>

<h3 id="using-cart-attributes-and-webhooks-together">Using Cart Attributes and WebHooks Together</h3>

<p>Using a WebHook to capture paid orders we inspect the line items and the cart attributes for quantities and dates per product. Setting up a small data structure to record the dates and quantities means the Shop keeper can generate a nice Excel style grid of weekly deliveries with the ability to plan ahead. Once that proved successful, and many thousands of orders were being booked, it turned out that the ability to fulfill orders automatically using the API was crucial. The reason is that since you can fulfill an order as many times as you want, an order that has deliveries in the future can be fulfilled <em>each</em> time a delivery comes up. When you use the API to fulfill an already fulfilled but open order, the Shipping Confirmation email goes out, alerting the shopper that their delivery is on the way. Only when all deliveries are completed does an order get closed.</p>

<h3 id="adding-upsells-to-boost-sales">Adding Upsells to Boost Sales</h3>

<p>At this point the store was running smooth. The shop owner wanted to add a twist to the cart. He wanted to <em>upsell</em> special products with the existing products. As an example, when Valentines rolls around it would be nice to offer a box of chocolates as an additional product. By creating a new product in Shopify and setting it&#x2019;s type to <em>upsell</em> we could offer this special product along side the regular products. The App allows the shop to assign any products of type <strong>upsell</strong> to any other regular products. Using Liquid, if the regular product has been assigned any <strong>upsell</strong> products we can render them too.</p>

<p>By presenting upsell products the shop was able to sell a huge amount of additional products per order. Upsells were an immediate hit. Using the API to customize the operation of a shop can really boost sales. One particular day saw an upsell convert on 1449 of 1450 carts. That is pretty impressive in my books.</p>

<h3 id="adding-sms-notifications">Adding SMS Notifications</h3>

<p>With so many people now using smartphones and SMS services, it made sense to add this to the shop fulfillment operations. It was easy enough to add a form to the shop&#x2019;s <em>Thank You</em> page asking the shopper if they wanted an SMS message when their order was fulfilled. Remarkably a huge number of people have provided their SMS numbers. The App now sends an SMS to each person when their order is fulfilled as opposed to an email which can sometimes be blocked by corporate firewalls.</p>

<p>This kind of customization illustrates how you can use the Shopify platform with confidence, knowing that it can handle twists that get thrown into the typical mix of scenarios that are possible. Some other recent surprising experiences came from integrating Shopify with the well known Salesforce CRM system. It turns out that when you subscribe to Salesforce and want to send orders there, they did not process the WebHook XML properly. A quick bridge was built by deploying an App to the cloud to accept these WebHooks from Shopify, and having the App then forward the order to Salesforce using XML formatted in a way that Salesforce was capable of accepting. Additionally, Salesforce comes with some pretty severe limits on what you can do with an entry level plan. Sometimes it turns out that you can do better with an App running in the cloud, so bridging Shopify to an App and Salesforce has shown itself to be a pretty powerful but cost effective system too. Shopify is soon to release an approved SalesForce App so that will likely appeal to the CRM crowd.</p>

</div>
    <div class="chapter"><h2 id="shopify-inventory">Shopify Inventory</h2>

<p>When I am working out a development plan with my engineering hat on, I always put the inventory setup first, and things like the theme last. To achieve success a shop needs to present inventory in a way that complements a smooth shopping experience and that is not necessarily accomplished with a gallery, carousel, slideshow or other front-end gimmick. Sometimes deeper thinking about how a product, it&#x2019;s variants, pricing, images and options will dictate the sales process. If the inventory is not organized correctly too much work can be expended in a fruitless quest for more sales.</p>

<p>A product requires at a minimum only a title. The title will then be turned into a unique <em>handle</em> that is a reference to the product in the shop. A quick example is a product with the title <strong>Quick Brown Fox</strong>. Shopify will set a handle to this product as <strong>quick-brown-fox</strong> and the product will then be found online as the shop&#x2019;s URL appended with /products/quick-brown-fox. Without no further action a product has been created and added to inventory that has a zero dollar price, infinite inventory, no tags, images, description or other useful attributes. It exists for the purposes of showing up on the site and can be accessed with an API call using the handle or ID it was assigned. You can <em>always</em> get the ID of a product simply by looking at the URL in the shop admin for the product when editing it. And example would be /admin/products/90368349 where the 903368349 is the unique ID for the product. As long as that product exists in the shop, that number will never change. It is used during import and export operations to identify products that will need to be updated. It is also handy to use that number when quickly checking out a product with the API. For example perhaps we want to quickly see if a product has any metafields. A very quick but effective command-line effort would be:</p>
<div class="figure">
<img alt="Example API Call" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/api%20call2.png" /></div>
<p>With just a couple of keystrokes we found a product and we are able to see that it has no metafield resources attached to it.</p>

<p>When setting up a product in inventory we can edit the variant and provide a title for the variant as well as it&#x2019;s price, SKU and inventory management policy. Shopify also provides three options that can be assigned to a variant. If a product has a colour, size and material they can be accommodated as options. These options could be anything so there is a fair amount of flexibility in using them. A product with attributes like density, plasticity, taste, style, or even chemical composition could be setup. Assuming all three options are used Shopify allows a product up to 100 variants. This means a product with five colours, four sizes and three materials would require 5 times 4 times 3 or 60 variants. Each one counts as an SKU in Shopify for the pricing plan selected. It is not necessary to assign an SKU to each variant, and you can assign the same SKU to as many variants as needed. Shopify simply treats the SKU as an attribute with no special meaning. Using the Shopify Ajax API it is very simple to use the handle of a product to get all of it&#x2019;s attributes. If we open up a store that has a version of the API code rendered as part of the theme, we can use the developer tools of our browser to inspect the details.</p>
<div class="figure">
<img alt="Getting Product Info using Ajax" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/ajax%20product2.png" /></div>
<p>An examination of the object representing a Shopify product shows us the structure of a product&#x2019;s options and how they are responsible for attributes generated for each variant. We can use this to completely customize the way Shopify renders products and variants. Many shops use the code Shopify provides to render each option as a separate HTML select element instead of one select element with each element separated with slashes. When a selection is made, a callback is triggered with the variant and that allows a shop to update things like pricing and availability. It is simple, reliable and it works. It can be relied on by developers to take front-end shop development to the next level beyond those basics.</p>

<p>If there are images uploaded for a product it is possible to detect images that might match the SKU assigned to the variant or perhaps the variant title. It is easy to make up some rules dictating how images that are uploaded for a product are coded so that code can be used in the callback logic.</p>

<p>A pattern I have used successfully to bring to life shops with clickable image swatches that change the variant, loading new sets of thumbnails, and allowing a mix of select elements with color swatches is to simply add a small script library to the shop containing code to work with the options. I let the default Shopify code <strong>option_selectors.js</strong> run knowing it will setup the HTML select elements and wire up whatever callback I want. I hide all the select elements Shopify generated. I modify the callback to run any extra code I may need to ensure smooth operations with the selections. Since I hid the HTML select elements, I run code that renders images or color swatches representing the variants. Each set of thumbnails or color swatches is assigned a click listener and that is the key to ensuring the right variant is selected. A click on an image that represents the product with the style &#x201C;faux beaver fur&#x201D; can trigger the change event on the hidden HTML select element setting it to the value &#x201C;faux beaver fur&#x201D; and the callback function will be called with the correct variant. Fabulous and simple. Clicks on an image can be so much more intuitive than selecting text from a drop down element. Perhaps the product has not only faux beaver fur but also an option called colour represented by clickable colour boxes. A click on any of the colour boxes would be recognized as <strong>blue</strong>, <strong>red</strong> or perhaps <strong>green</strong>. We could change the background colour of the main image to match. Or we could load new images of the product with &#x201C;beaver faux fur&#x201D; colourized to match.</p>

<p>Knowing how Shopify inventory works with respect to variants and options is crucial to building out shops with advanced capabilities. To take a shop to a level where shoppers can easily add the product of their choice into the cart and buy it without guesswork or too much reading is essential. Knowing that you can upload as many images of a product as you want does not make it easy to swap the images when options are selected. One technique is to use the Shopify administration interface to add text to product image alt attributes. Those should be used for improving SEO but they can also be used to make a primitive image swapper work. For example, if the alt tag was set to a color that matched the variant title, you could swap the image currently visible with one that matches color wise when a variant change is detected. A more sophisticated approach would be to examine the name of the image itself. Basic regular expressions can be used to parse a filename into all of it&#x2019;s parts. That might be <strong>white_lily_formica_solipstic_grande.jpeg</strong> where you can decide that the click was on a <em>white lily</em> colored <em>formica solipstic</em> variant and that the image is Shopify grande in size. Now, with a tiny bit of code, you could substitute the image uploaded as <strong>black_lily_formica_solipstic.jpeg</strong> and you could set the size to medium using the source <strong>black_lily_formica_solipstic_medium.jpeg</strong>.</p>

<p>Sometimes you have to present a list of colours but the sizes should remain as an HTML select element. Don&#x2019;t hide the select element for size changes. Be aware that when showing and hiding elements like the ones Shopify renders in their option_selectors.js file, that they are using a numbering scheme derived from the representation of the product object too. If there are three options, they are listed as option1, option2, option3 and that you might have the actual options in an array where option<span>0</span> is option1, coming from a click on a select element with the DOM ID product-select-option-0 depending on how you called the select element in your theme (in this case ID was product-select).</p>

<p>In summary, it is possible to present your Products in Shopify with pretty amazing effects triggered by clicks on elements other then HTML select elements, while maintaing control over the current variant, meaning you can update prices and keep the add to cart action enabled or disabled depending on inventory settings.</p>

</div>
    <div class="chapter"><h2 id="the-shopify-api">The Shopify API</h2>

<p>One of the most interesting features of Internet computing that has evolved since the 1990&#x2019;s has been the introduction and growth of service oriented companies that work strictly using Internet protocols. YouTube, Twitter, Facebook, Shopify and multitudes of other companies that run from modest brick and mortar headquarters, have relatively small employee head counts but count millions and perhaps billions of people as users of their services. Little of their success can be attributed to pounding the pavment door to door, or by flooding the TV with advertising. Service oriented companies leverage the Internet itself for their growth and one of the underlying reasons for their rapid growth, adoption and success is due the concept of the API or Application Programming Interface.</p>

<p>What better way to introduce the public at large to your service than to allow them to build it, populate it and enjoy it using their own labour and tools. YouTube, Facebook and Twitter would not exist without user generated content. How to ensure everyone can contribute to your service without being overly technical or specialized? How to accept a video from an iPhone or Android phone, an iPad or Galaxy Tablet, a Mac or a PC? The key is the use and promotion of an API. Provide a simple mechanism everyone can take advantage of and the ball starts rolling.</p>

<p>Shopify released their API after some years of processing a steadily growing number of transactions (perhaps some would see it as explosive growth). A period of time during which Shopify surely learned not only to understand the intimate details of what happens when millions of dollars flow through Internet cash registers, but also the huge number of possibilities and limitations that can be faced by a codebase. Once the early established shops crossed the chasm from early adopters to profitable e-commerce enterprises, there was a corresponding demand for more and better control of the underlying processes.</p>

<p>Shopify chose to establish their API using the software architecture known as <strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer (REST) accepted by a majority of the Internet community. The API provides support for accessing a Shopify shop and creating, reading, updating or deleting the resources of the shop. Almost all e-commerce companies offer some sort of API but there is a clearly a difference in the degree of maturity and the amount of thought that has gone into some of them. The Shopify API is proving to be very helpful in advancing the capabilities of many thousands of shops. Whenever the general question is asked &#x201C;Can Shopify do such and such?&#x201D;, I am often answering the question with a confident &#x201C;Yes it can, you simply need to use the API.&#x201D;</p>

<p>If we accept that software is one of the most fiendishly diffcult man-made constructs invented and if we accept that even after nearly seventy years of computing research and development we are still stumbling along like drunk sailors, we must learn to accept and set limits while we sort it all out. Shopify has established a working e-commerce system transacting hundreds of millions of dollars per year for many thousands of merchants, but it cannot stray too far from the model that currently works. If all the many requested features were added, the system would likely become unstable and prone to outages, breakdowns and a destroyed reputation for reliability. We know some of the most expensive human mistakes ever can be attributed to computer bugs no one ever knew were there till it was too late. By offering an API built around a core set of resources Shopify has enabled an ecosystem of App developers to come together and create unique and necessary offerings to make running an e-commerce shop on the Shopify platform easier for merchants.</p>

<p>A good example would be the task of fulfilling an order. Shopify has a setup option allowing a merchant to select from a few fulfillment companies. What happens when you check out that short list and you do not see your option? Your supply chain from Manufacturer DrubbleZook to warehouse Zingoblork with shipper USPS or Royal Mail is simply not there. But you know every single order can be sent to an App. You know you can select up to 250 orders at once and send them all to an App. So surely an App can be built to handle the fulfillment. An App running in the cloud listening 24/7 for incoming orders. And when it gets an order it robotically follows a set of instructions that ensures the Shopify merchant is going to be happy. The App takes the order apart and inspects it. The App knows where each line item is to be sent. It knows the ID of every variant, and whether a discount code was used. It knows the credit cart issuer. The App can take the order from Shopify and format it for Zingoblork and their special needs. It is 2012 as I write this and Zingoblork warehouse runs off of any of the following data exchange mechanisms:</p>

<ul><li>a Microsoft DOS server, connected to the Internet by FTP. They only accept CSV files via FTP</li>

<li>a Microsoft NT Server, connected to the Internet by sFTP. They only accept CSV files via sFTP</li>

<li>email. The company can only deal with email. They have been around forty years, and it&#x2019;s all email all the time</li>

<li>HTTP POST. A modern miracle! A warehouse fulfillment company that actually has IT!</li>

<li>EDI which we won&#x2019;t even bother to describe, but suffice it to say, the Chevy Vega of exchanges</li>

<li>SOAP which makes me want to run away and mow grass for a living</li>
</ul><p>The App accepts all orders thanks to the API and perhaps in combination with WebHooks it processes them and sends them off to the fulfillment company. Once the fulfillment company has accepted the order(s) and sent them off to their final destination as a delivery, the person that bought the goods needs to know. Some companies will collect all the orders they process for a shop and create a daily manifest of tracking codes assigned to the orders and place those in a holding pen accessible only by a special FTP account. Others will simply send these codes to the shop via email completely destroying the shop keepers email inbox and sanity. The best fulfillment companies will use HTTP POST to send the order with a tracking number back to the App allowing the App to automatically create a fulfillment using the API with the tracking code. Shopify automatically detects the creation of a new fulfillment and sends an appropriate email. This is wonderful since the App and the API together can close the loop automatically.</p>

<p>Without an API it would be impossible to offer this level of customization to a shop. Another interesting use of Shopify is when a shop is opened up to sell products on a consignment basis. If I accept 1000 of your widgets to sell in my shop for $20 each you want to know if you have made $20 in sales or $400 in sales or even $4000 in sales. If I accept 1000 widgets to sell on behalf of 20 or 30 different vendors my life will almost certainly be miserable unless I use the API. I record each and every line item sold as a sale assigned to the product&#x2019;s vendor. Every product has a selling price and a cost price and so we know the difference between those should be the profit to split between me and my vendor(s). I have a deal with my vendors giving them 80/20 or sometimes 60/40 splits of that profit. We really should assign that percentage to each sale as well so that we can make different deals depending on the day of the week, the colour of the sky or the popularity of the product at the checkout. That is an App that can be plugged into a shop. None of that is possible without an App.</p>

<p>The presence and functionality of the Shopify API is a crucial variable in the decision equation most enterprises work out before going into business with the Shopify platform. If a business knows the fixed costs to run a shop for a year are $1000 and that their theme will cost them $5000 to make the shop attractive, the API is the only other key option that deserves close attention. Adding an App can add monthly or one-time fees, but they can also save hundreds of hours in manual labour. Paying for a custom App to be developed to address a special need can cost a few thousand dollars but can result in measurable growth in sales. Many companies are looking for a reliable hosted e-commerce platform and partner(s) to work with to bring their e-commerce vision to life. Knowing they can use the API to add the little extras is often enough incentive to choose Shopify over competing platforms.</p>

</div>
    <div class="chapter"><h2 id="how-to-handle-webhook-requests">How to Handle Webhook Requests</h2>

<p>This is a big one and important topic. If Shopify doesn&#x2019;t receive a 200 OK status response within 10 seconds of sending an App a WebHook, Shopify will assume there is a problem and will mark it as a failed attempt. Repeated attempts will be made for up to 48 hours. A common cause for failure is an App that performs some complex processing when it receives a WebHook request before responding. When processing WebHooks a quick 200 OK response that acknowledges receipt of the data is more essential.</p>

<p>Here&#x2019;s some pseudocode demonstrating what I mean:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">handle_webhook</span> <span class="n">request</span>
  <span class="n">process_data</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>    <span class="c1"># Note that the process_data call could take a lot of time</span>
  <span class="n">status</span> <span class="mi">200</span>
<span class="k">end</span>
</pre>
</div>
<p>To make sure that you don&#x2019;t take too long before responding you should defer processing the WebHook data until <em>after</em> the response has been sent. Delayed or background jobs are perfect for this.</p>

<p>Here&#x2019;s how your code could look:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">handle_webhook</span> <span class="n">request</span>
  <span class="n">schedule_processing</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>    <span class="c1"># this takes no time so the response is quick</span>
  <span class="n">status</span> <span class="mi">200</span>
<span class="k">end</span>
</pre>
</div>
<p>Even if you&#x2019;re only doing a small amount of processing, there are other factors to take into account. On-demand cloud services such as Heroku or PHPFog will need to spin up a new processing node to handle sporadic requests since they often put Apps to sleep when they are not busy. This can take several seconds. If your App is only spending five seconds processing data it&#x2019;ll still <em>fail</em> if the underlying server took five seconds to start up.</p>

<h3 id="the-interesting-world-of-webhooks">The Interesting World of WebHooks</h3>

<p>Shopify does a fine job of introducing and explaining WebHooks on the wiki, and there are some pretty nifty use cases provided. The <em>best practices</em> are essential reading and should be thoroughly understood to get the most out of using WebHooks. In my experience with Webhooks I have run into all sorts of interesting issues so I will dedicate some effort to explaining them from an App developer perspective.</p>

<p><a href="http://wiki.shopify.com/WebHook#How_Should_I_Handle_Webhook_Requests">Shopify WebHooks Documentation</a></p>

<p>When you are dealing with Shopify Webhooks you are in the Email &amp; Preferences section of a shop. You can setup a WebHook using the web interface. Pick the type of WebHook you want to use and provide a URL that will be receiving the data. For those without an App to hook up to a shop there are some nifty WebHook testing sites available that are free to use. Let&#x2019;s take one quick example and use RequestBin. The first thing I will do is create a WebHook listener at the <a href="http://requestb.in/" title="RequestBin">Request Bin</a> website.</p>
<div class="figure">
<img alt="Create a new RequestBin for your WebHook" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/request_bin_home2.png" /></div>
<p>Pressing the <em>Create a RequestBin</em> button creates a new WebHook listener. The result is a generated URL that can be used for testing. Note that one can also make this test private so that only you can see the results of WebHooks sent to the RequestBin.</p>
<div class="figure">
<img alt="Newly Created RequestBin" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/request_bin_created2.png" /></div>
<p>The RequestBin listener is the URL that can be copied into the Shopify Webhook creation form at the shop&#x2019;s Email &amp; Preferences administration section. http://www.postbin.org/155tzv2 where the code <strong>155tzv2</strong> was generated just for this test. Using the WebHook create form one can pick the type of WebHookto test and specify where to send it.</p>
<div class="figure">
<img alt="WebHook Created in Shopify Email and Preferences" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/webhook_created2.png" /></div>
<p>When the WebHook has been created you can send it to the RequestBin service any time by clicking on the <strong>send test notification</strong> link and standing by for a confirmation that it was indeed sent.</p>
<div class="figure">
<img alt="Testable WebHook" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/webhook_testable2.png" /></div>
<p>The ability to delete a WebHook as well as test it in the shop has on occasion burned me. In my haste to deal with a situation involving WebHooks I have been guilty of accidentally pressing the trashcan icon and removing a WebHook that should <em>never have been removed</em>. Ooops! It can take only seconds of carelessness to decouple a shop set for live e-commerce sales from a crucial App running and connected to the shop. Be careful when clicking around these parts!</p>

<p>Sending a test is easy, and the result should be immediately available in RequestBin. My example shows a test order in JSON format.</p>
<div class="figure">
<img alt="WebHook Results" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/webhook_results2.png" /></div>
<p>Looking closely at the sample order data which is in JSON format we see there is a complete test order to work with. We have closed the loop on the concept of creating, testing and capturing WebHooks. The listener at RequestBin is a surrogate for a real one that would exist in an App but it can prove useful as a development tool.</p>

<p>For the discussion of WebHook testing we note that the sample data from Shopify is great for testing connectivity more than for testing out an App. Close examination of the provided test data shows a lot of the fields are empty or null. What would be nice is to be able send real data to an App without the hassle of actually using the Shop and booking test orders. For example, say you are developing an Application to test out a fancy order fulfillment routine a shop needs.</p>

<p>You know you need to test a couple of specific aspects of an Order, namely:</p>

<ol><li>Ensure the WebHook order data actually came from Shopify, and that you have the shop identification to work on.</li>

<li>Ensure you do not already have this order processed as it makes no sense to process a <em>PAID</em> order two or more times.</li>

<li>You know you need to parse out the credit card used, and the shipping charges, and the discount codes used if any.</li>

<li>There could be product customization data in the cart note or cart attributes that need to be examined.</li>
</ol><p>This small list introduces some issues that may not be obvious to new developers to the Shopify platform. We can address each one and hopefully that will provide some useful insight into how you can structure an App to best deal with WebHooks from Shopify.</p>

<h3 id="webhook-validation">WebHook Validation</h3>

<p>When you setup an App in the Shopify Partner web application one of the key attributes generated by Shopify for the App is the authentication data. Each App will have an API key to identify it as well as a shared secret. These are unique tokens and they are critical to providing a secure exchange of data between Apps and Shopify. In the case of validating the source of a WebHook, both Shopify and the App can use the shared secret. When you use the API to install a WebHook into a Shop, Shopify clearly knows the identity of the App requesting the WebHook to be created, so Shopify uses the shared secret associated with the App and makes it part of the WebHook itself. Before Shopify sends off a WebHook created by an App it will be use the shared secret to compute a Hash of the WebHook payload and embed this in the WebHook&#x2019;s HTTP headers. Any WebHook from Shopify that has been setup with the API will have HTTP_X_SHOPIFY_HMAC_SHA256 in the Request&#x2019;s header. Since the App has access to the shared secret, the App can now use that to decode the incoming request. The Shopify team provides some working code for this.</p>
<div class="highlight"><pre><span class="no">SHARED_SECRET</span> <span class="o">=</span> <span class="s2">"f10ad00c67b72550854a34dc166d9161"</span>
<span class="k">def</span> <span class="nf">verify_webhook</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hmac_header</span><span class="p">)</span>
  <span class="n">digest</span>  <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">Digest</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">)</span>
  <span class="n">hmac</span>    <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="no">SHARED_SECRET</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span>
  <span class="n">hmac</span> <span class="o">==</span> <span class="n">hmac_header</span>
<span class="k">end</span>
</pre>
</div>
<p>If we were to send the request body as the App received it to this little method, and the value of the HTTP_X_SHOPIFY_HMAC_SHA256 attribute in the request, it can calculate the Hash in the same manner as Shopify did before sending out the request. If the two computed values match, you can be assured the WebHook is valid and came from Shopify. That is why it is important to ensure your shared secret is not widely distrubuted on the Internet. You would lose your ability to judge between valid and invalid requests between Shopify and your App.</p>

<h3 id="looking-out-for-duplicate-webhooks">Looking out for Duplicate Webhooks</h3>

<p>As explained in the WebHook best practices guide, Shopify will send a WebHook out and then wait up to ten seconds for a response status. If that response is not received the WebHook will be resent. This continues until a 200 OK status is received ensuring that even if a network connection is down or some other problem is present Shopify will keep trying to get the WebHook to the App. The initial interval between retries of ten seconds is not practical for a large number of retries so the time interval between requests is constantly extended until the WebHook is only retried every hour or more. If nothing changes within 48 hours an email is sent to the App owner warning them their WebHook receiver is not working and that the WebHook itself will be deleted from the shop. This can have harsh consequences, mitigated by the fact that the email should be sufficient to alert the App owner to the existence of a problem.</p>

<p>Assuming all is well with the network and the App is receiving WebHooks it is entirely possible that an App will receive the odd duplicate WebHook. Shopify is originating WebHook requests in a Data Center and there are certainly going to be hops through various Internet routers as the WebHook traverses various links to your App. If you use the tracert command to examine these hops you can see the latency or time it takes for each hop. Sometimes, an overloaded router in the path will take a long time to forward the needed data extending the time it takes for a complete exchange between Shopify and an App. Sometimes the App itself can take a long time to process a WebHook and respond. In any case a duplicate is possible and the App might have a problem unless it deals with the possibility of duplicates.</p>

<p>A simple way to deal with this might be to have the App record the ID of the incoming WebHook resource. For example, on a paid order if the App knows apriori that order 123456 is already processed, any further orders detected with the ID 123456 can be ignored. Turns out in practice this is not a robust solution. A busy shop can inundate an App with orders/paid WebHooks and at any moment no matter how efficient the App is at processing those incoming WebHooks, there can be enough latency to ensure Shopify sends a duplicate order out.</p>

<p>A robust way to handle WebHooks is to put in place a Message Queue (MQ) service. All incoming WebHooks should be directed to a message queue. Once an incoming WebHook is successfully added to the queue the App simply returns the 200 Status OK response to Shopify and the WebHook is completed. If that process is subject to network latency or other issues it makes no difference as the queue welcomes any and all WebHooks, duplicates or not.</p>

<p>With an App directing all incoming WebHooks to an queue a queue worker process can be used to <em>pop off</em> WebHooks in the queue for processing. There is no longer a concern over processing speed and the App can do all the sophisticated processing it needs to do at it&#x2019;s leisure. It is possible to be certain whether an orders/paid WebHook has been processed already or not. Duplicated WebHooks are best taken care of with this kind of architecture.</p>

<h3 id="parsing-webhooks">Parsing WebHooks</h3>

<p>Shopify provides WebHook requests as XML or as JSON. Most scripting languages used to build Apps have XML parsers that can make request processing routine. With the advent of NoSQL databases storing JSON documents such as CouchDB and MongoDB many Apps take advantage of this and prefer all incoming requests to be JSON. Additionally one can use Node.js om the server to process WebHooks and so JSON is a natural fit for those applications. Since the logic of searching a request for a specific field is the same for both formats, it is up to the App author to choose the format they prefer.</p>

<h3 id="cart-customization">Cart Customization</h3>

<p>Without a doubt one of the most useful but also a more difficult aspect of front end Shopify development is in the use of the cart note and cart attribute features. They are the only way a shop can collect non-standard information directly from a shop customer. Any monogrammed handbags, initialed wedding invitations, engraved glass baby bottles etc. will have used the cart note or cart attributes to capture this information and pass it through the order process. Since a cart note or cart attribute is just a key and value, the value is restricted to a string. A string could be a simple name like &#x201C;Bob&#x201D; or it could conceivably be a sophisticated Javascript Object like &#x201D;<span>{&#x201C;name&#x201D;: &#x201C;Joe Blow&#x201D;, &#x201C;age&#x201D; : &#x201C;29&#x201D;, &#x201C;dob&#x201D;: &#x201C;1958-01-29&#x201D;},{&#x201C;name&#x201D;: &#x201C;Henrietta Booger&#x201D;, &#x201C;age&#x201D; : &#x201C;19&#x201D;, &#x201C;dob&#x201D;: &#x201C;1978-05-21&#x201D;},..{&#x201C;name&#x201D;: &#x201C;Psilly Psilon&#x201D;, &#x201C;age&#x201D; : &#x201C;39&#x201D;, &#x201C;dob&#x201D;: &#x201C;1968-06-03&#x201D;}</span>&#x201D;. In the App, when we detect cart attributes with JSON, we can parse that JSON and reconstitute the original objects embedded in there. In my opinion it is this pattern of augmenting orders with cart attributes, passing them to Apps by WebHook and then parsing out the special attributes that has made it possible for the Shopify platform to deliver such a wide variety of e-commerce sites while keeping the platform reasonably simple.</p>

</div>
    <div class="chapter"><h2 id="command-line-shopify">Command Line Shopify</h2>

<p>Quick development of Apps requires being able to fire off requests to a shop and to be able to process the responses. While WebHooks are a source of incoming data from a Shop many interesting possibilities are available using a terminal to access the API at the command line.</p>

<p>When firing off a request for a resource from a Shop using one of the formats of JSON or XML, we are using a standard HTTP verb like GET. To quickly send a GET request to a shop with authentication can be an involved setup process using the command line. For example, we could use the venerable curl command to send of a request for a Shop, Product or Collection resource. Doing so by hand can be tedious in my opinion. There are much more sophisticated ways to do this without having to run an App and inspect the responses and run debuggers. While I enjoy single-stepping through live code and inspecting the state of my objects that make up an App, I also appreciate being able to quickly test out a theory or check on code syntax without the burden of that overhead.</p>

<p>Shopify has a super example of how to do just this and it is a small application they bundle with their Ruby gem. Some time ago, before Rails merged with Merb, the Merbists advanced the concept of command-line interface (CLI) development for Ruby with the introduction of Thor. Thor is Ruby code that lets you quickly write a command-line interface. The current Shopify API gem comes with one of these built-in.</p>

<p>If you have installed the Shopify API gem and you start a terminal session on your computer you will be able to test this out fairly quickly. I use RVM to manage all my versions of Ruby, but there are alternatives including RBENV and the usual nothing special at all I use the default installed with my computer. I am making the bold assumption that most developers are using a computer with Ruby (or any dynamic scripting language for that matter, be it Perl, PHP, Python or others) and that a terminal session is part of their toolkit.</p>

<p>When I use Ruby, and I check my installed gems using the gem list command, I see the shopify api gem in my list and I can test for the Shopify CLI by simply typing in the command <strong>shopify</strong>.</p>
<div class="figure">
<img alt="Available Options for the shopify Command Line Interface" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/CLI2.png" /></div>
<h3 id="the-shopify-command-line-console">The shopify Command Line Console</h3>

<p>There are just a few options listed and in order to really cook up some interesting examples we will use the configure option that comes with the command. The options required to configure a shopify session are the Shops API key and a password. To get those values, we will use the Shop itself. For some developers this will mean using their development shop, and for others, their clients have provided access to their shop so a private App can be created, or they created the Private App for the developer and passed on the credentials. The following screen shots show the exact sequence.</p>
<div class="figure">
<img alt="Menu Options to Setup Shop Access for the Command Line" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/Manage%20Apps2.png" /></div><div class="figure">
<img alt="Setting Up Access for a Private Application" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/Private%20Application2.png" /></div><div class="figure">
<img alt="Final Step Reveals the Needed Access Credentials" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/Private%20App.png" /></div>
<p>When examining the credentials provided for a Private App Tool, we use the API key and Password along with the shop&#x2019;s name. Once we have completed the configuration, we can access the shop using a console.</p>

<p>As an example, here is a console session for a development shop, showing how easy it is to query for the shop&#x2019;s count of products, orders, and the details of a single order.</p>
<div class="figure">
<img alt="Output of Calling a Shop Using the API" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/shopify_console.png" /></div>
<p>Now we can test out potential code snippets quickly without incurring a lot of overhead. API code can be tested with the fewest possible keystrokes and minimum effort with this handy console. For example we know we can access metafields resources for a shop by providing an ID for the resource. What is the syntax of a call with Active Resource? It can be a challenge to keep perfect API syntax in your head, so we often just try things out to see if they work. With the console I can try a few different call patterns until I stumble on the correct one.</p>

<p>With the shopify utility we can add connections to as many Shops as we want and we can list them all. When working on a client shop one of the first things I do is use the shops admin interface and the App tab to create a private tool. With the resulting API key and password I can use the shopify console tool to quickly test out any custom queries I may want to build into an App for the client.</p>

<h3 id="the-shopify-theme-command-line-console">The Shopify Theme Command Line Console</h3>

<p>The second useful command line tool that Shopify provides is not in the shopify_api gem but is a separate gem called shopify_theme. With this gem installed on your system you can use the command <strong>theme</strong> to work with shop code directly. Theme is another fine command line tool with a simple workflow. The first thing I do with a new client is create a directory to hold all the files that make up the client&#x2019;s theme.</p>

<pre><code>$ mkdir fizz-buzz.com
$ cd fizz-buzz.com
$ theme configuration</code></pre>
<div class="figure">
<img alt="Output of the Theme Command Line Console" src="file://localhost/Users/dlazar/Pictures/Shopify%20E-Book/theme%20console2.png" /></div>
<p>You can see from the listing of available options the <em>theme</em> commmand is slightly different from the <em>shopify</em> command. Nonetheless it uses the exact same API key and password to access a shop&#x2019;s resources. Provide the credentials and the configuration is written out as a file and we can begin work. The first step is to download the client&#x2019;s theme into the working directory so that I can examine their Javascript, and Liquid assets like the templates.</p>

<pre><code>$ theme download</code></pre>

<p>Once the assets are downloaded I setup the files under version control. I make a local repository with git and store the client&#x2019;s code under version control for safety. You could even go so far as to setup a git remote pointing at github so that your work is safely stored in a private repository there too.</p>

<pre><code>$ git init
$ git add .
$ git commit -m 'initial commit of Shopify code for client XYZ'</code></pre>

<p>With the code in git it is a good time to start working. I use the <em>theme watch</em> command to watch the directory for any changes. As soon as a change is registered to a file, the theme watcher will transmit the changed file to the client site where the file was downloaded from. I can verify my edit worked (or not) using my web browser and viewing the shop. When I am happy a small change is a good change I commit the change to git and move on to the next task.</p>

<pre><code>$ git commit -am 'Fixed that pesky jQuery error the client had from blindly copy and pasting some bad code off the Internet'</code></pre>

<p>This is a very productive and safe workflow in my opinion. I have the code under version control and I can make my edits using my favorite code editing tools. If in the future the client wants more work done I can use the theme download tool to grab any new files or changes to files initiated by the client in the meantime. Git will tell me what changes if any are present and I can investigate those. Sometimes it is a simple task to fix something this way. At least you have a fighting chance when you are not the only person touching or editing a client site. Squashing some designers work or other persons files is rarely an acceptable practice!</p>

</div>
  
    </div>

    <div class="imprint container">
      <div>
        <h2>A Developer's View of the Shopify Platform</h2>
        <p>David Lazar</p>
        <p>Copyright (C) 2012 David Lazar.</p>
      </div>
    </div>
  </body>
</html>
